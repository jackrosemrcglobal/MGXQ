<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MRC GLOBAL QMS</title>
  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #0a101a, #263147);
      color: #fff;
      min-height: 100vh;
      overflow-x: auto;
    }
    button {
      cursor: pointer;
      background: none;
      border: none;
      color: inherit;
      font: inherit;
    }
    svg {
      width: 24px;
      height: 24px;
    }

    /* Header Styles */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background-color: #222;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 1000;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .menu-btn {
      background: none;
      border: none;
      padding: 5px;
      color: #fff;
    }
    .brand-text {
      font-size: 18px;
      font-weight: bold;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .icon-btn {
      background: none;
      border: none;
      padding: 5px;
      color: #fff;
    }
    /* Custom user icon sizing */
    #userBtn svg {
      width: 32px;
      height: 32px;
    }

    /* Sidebar (hidden by default) */
    .sidebar {
      position: fixed;
      top: 60px;
      left: -250px;
      width: 250px;
      height: calc(100% - 60px);
      background: #1c1c1c;
      transition: left 0.3s ease;
      padding: 20px;
      z-index: 900;
      overflow-y: auto;
    }
    .sidebar.open {
      left: 0;
    }
    .sidebar h2 {
      font-size: 18px;
      margin-bottom: 15px;
    }
    .sidebar ul {
      list-style: none;
    }
    .sidebar li {
      margin-bottom: 10px;
    }

    /* Main Content */
    .main-content {
      padding: 20px;
      margin-top: 60px;
    }
    /* Title and Tabs Section */
    .title-section {
      margin-bottom: 20px;
    }
    .title-section h1 {
      font-size: 28px;
      margin-bottom: 15px;
    }
    .tabs-wrapper {
      display: flex;
      align-items: center;
    }
    .scroll-btn {
      background: rgba(0, 0, 0, 0.3);
      border: none;
      padding: 5px 10px;
      font-size: 18px;
      color: #fff;
      border-radius: 4px;
    }
    .tabs-container {
      overflow-x: auto;
      margin: 0 10px;
      flex-grow: 1;
    }
    .tabs {
      display: flex;
      list-style: none;
      gap: 15px;
    }
    .tabs li {
      white-space: nowrap;
      padding: 5px 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      flex-shrink: 0;
    }

    /* Dashboard View: Quick Actions and Big Buttons */
    .body-content {
      display: flex;
      gap: 20px;
    }
    .big-buttons {
      flex-grow: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 20px;
    }
    .big-button {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      padding: 20px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      aspect-ratio: 1 / 1;
      font-size: 14px;
      transition: background 0.2s ease;
    }
    .big-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .big-button.add {
      font-size: 24px;
      font-weight: bold;
    }

    /* Section View (Detail view for a selected ISO module) */
    .section-view {
      padding: 20px;
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .section-header h2 {
      font-size: 24px;
    }
    .section-header button {
      background: rgba(255,255,255,0.1);
      color: #fff;
      padding: 5px 10px;
      border-radius: 4px;
    }
    .records-table {
      width: 100%;
      border-collapse: collapse;
    }
    .records-table th,
    .records-table td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    .records-table th {
      background: #333;
    }
    .records-table td button {
      margin-right: 5px;
      padding: 3px 6px;
      font-size: 12px;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal {
      background: #222;
      color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal h2 {
      margin-bottom: 15px;
    }
    .modal label {
      display: block;
      margin-top: 10px;
    }
    .modal input {
      width: 100%;
      padding: 5px;
      margin-top: 5px;
      background: #333;
      border: 1px solid #555;
      color: #fff;
    }
    .modal-actions {
      margin-top: 15px;
      text-align: right;
    }
    .modal-actions button {
      background: #444;
      padding: 5px 10px;
      border: none;
      color: #fff;
      margin-left: 10px;
      border-radius: 4px;
    }
    .modal-content {
      max-height: 80vh;
      overflow-y: auto;
    }
    /* Subsection Tabs Styles */
    #subsectionTabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    #subsectionTabs button {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }
    #subsectionTabs button.active {
      background: rgba(255, 255, 255, 0.3);
    }

    .favorites-dropdown {
      position: absolute;
      top: 60px; 
      right: 20px;
      background: #222;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 10px;
      width: 250px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 1001;
    }
    .favorites-dropdown .favorite-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #444;
    }
    .favorites-dropdown .favorite-item:last-child {
      border-bottom: none;
    }
    .favorites-dropdown .favorite-name {
      flex-grow: 1;
      cursor: pointer;
      padding: 0 5px;
    }
    .favorites-dropdown .favorite-actions button {
      background: none;
      border: none;
      color: #fff;
      padding: 0 3px;
      cursor: pointer;
    }

    .documents-dropdown {
      position: absolute;
      top: 60px; 
      right: 80px; 
      background: #222;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 10px;
      width: 250px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 1001;
    }

    /* --- New Notification Badge Styles --- */
    .notification-badge {
      position: absolute;
      top: 5px;
      right: 5px;
      background: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 12px;
    }

    /* New styles for view option buttons instead of dropdown */
    .view-option-btn {
      background: none;
      border: none;
      color: #fff;
      padding: 5px;
      cursor: pointer;
    }
    .view-option-btn.active {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }

    /* --- New Home Page Layout Styles --- */
    #homeView {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }
    #homeView .title-section {
      text-align: center;
      margin-bottom: 30px;
    }
    #homeView .title-section h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }
    #homeView .title-section p {
      font-size: 16px;
      color: #ccc;
    }
    #homeView .home-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      width: 100%;
    }
    #homeView .home-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      color: #fff;
      text-decoration: none;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    #homeView .home-card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.2);
    }
    #homeView .home-card h3 {
      font-size: 18px;
      margin-top: 10px;
    }
    
    /* New styles for List View: move numbers to the right */
    .dashboard-list {
      counter-reset: list-counter;
      list-style: none;
      margin: 0;
      padding: 0;
      color: white;
    }
    .dashboard-list li {
      counter-increment: list-counter;
      position: relative;
      padding-right: 40px; /* adjust spacing as needed */
      margin-bottom: 10px;
    }
    .dashboard-list li::after {
      content: "";
      position: absolute;
      right: 0;
      top: 0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <button id="sidebarToggle" class="menu-btn" aria-label="Toggle Sidebar" title="Toggle Sidebar">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <rect x="3" y="6" width="18" height="2"/>
          <rect x="3" y="11" width="18" height="2"/>
          <rect x="3" y="16" width="18" height="2"/>
        </svg>
      </button>
      <span class="brand-text">MRC GLOBAL QMS</span>
    </div>
    <div class="header-right">
      <!-- NEW: Replace View Options dropdown with individual icon buttons -->
      <div id="dashboardViewOptions" style="display: flex; gap: 10px; margin-right: 15px;">
        <button class="view-option-btn" data-mode="current" title="Big Icon View">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">
            <rect x="4" y="4" width="16" height="16"/>
          </svg>
        </button>
        <button class="view-option-btn" data-mode="smallIcon" title="Small Icon View">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width:16px;height:16px;">
            <rect x="4" y="4" width="16" height="16"/>
          </svg>
        </button>
        <button class="view-option-btn active" data-mode="list" title="List View">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">
            <line x1="4" y1="7" x2="20" y2="7" stroke="currentColor" stroke-width="2"/>
            <line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="4" y1="17" x2="20" y2="17" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
      <button class="icon-btn" id="searchBtn" aria-label="Search" title="Search">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" fill="none"></circle>
          <line x1="16" y1="16" x2="21" y2="21" stroke="currentColor" stroke-width="2"></line>
        </svg>
      </button>
      <input id="searchInput" type="text" placeholder="Filter Sections" style="display:none; margin-left:10px; background:#333; color:#fff; border:none; padding:5px 8px; border-radius:4px;">
      <button class="icon-btn" id="homeBtn" aria-label="Home" title="Home">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 9.5L12 3l9 6.5V21a1 1 0 0 1-1 1h-6v-7h-4v7H4a1 1 0 0 1-1-1V9.5z" />
        </svg>
      </button>
      <button class="icon-btn" id="favoritesBtn" aria-label="Favorites" title="Favorites">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
        </svg>
      </button>
      <button class="icon-btn" id="documentsBtn" aria-label="Documents" title="Documents">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">
          <path d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zM15 3.5V9h5L15 3.5z"/>
        </svg>
      </button>
      <button class="icon-btn" id="auditBtn" aria-label="Audit" title="Audit">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">
          <path d="M12 1a3 3 0 0 1 3 3v1h2a1 1 0 0 1 0 2h-2v2h2a1 1 0 0 1 0 2h-2v2h2a1 1 0 0 1 0 2h-2v1a3 3 0 0 1-6 0v-1H7a1 1 0 0 1 0-2h2V8H7a1 1 0 0 1 0-2h2V4a3 3 0 0 1 3-3z"/>
        </svg>
      </button>
      <!-- NEW: Resource Management Button -->
      <button class="icon-btn" id="resourceManagementBtn" aria-label="Resource Management" title="Resource Management">
        <svg viewBox="0 0 40 40" fill="currentColor">
          <circle cx="20" cy="20" r="20" fill="#444"/>
          <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" fill="#fff" font-size="12" font-family="Arial">RM</text>
        </svg>
      </button>
      <button class="icon-btn" id="notificationsBtn" aria-label="Notifications" title="Notifications">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M4 2h13a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4v4l-4-4 4-4v-8a1 1 0 0 1 1-1z"/>
        </svg>
        <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
      </button>
      <!-- NEW Export CSV Button -->
      <button class="icon-btn" id="exportBtn" aria-label="Export CSV" title="Export CSV">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M5 20h14v-2H5v2zm7-18l-7 7h4v6h6v-6h4l-7-7z" />
        </svg>
      </button>
      <button class="icon-btn" id="actionsBtn" aria-label="Open Actions" title="Open Actions">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2z"/>
          <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/>
        </svg>
      </button>
      <button class="icon-btn" id="userBtn" aria-label="User Profile" title="User Profile">
        <svg viewBox="0 0 40 40" fill="currentColor">
          <circle cx="20" cy="20" r="20" fill="#444"/>
          <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" fill="#fff" font-size="12" font-family="Arial">MGQS</text>
        </svg>
      </button>
      <!-- NEW: Admin Button (only visible for Admin users) -->
      <button class="icon-btn" id="adminBtn" aria-label="Admin" title="Admin">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">
          <path d="M12 1a3 3 0 0 1 3 3v1h2a1 1 0 0 1 0 2h-2v2h2a1 1 0 0 1 0 2h-2v2h2a1 1 0 0 1 0 2h-2v1a3 3 0 0 1-6 0v-1H7a1 1 0 0 1 0-2h2V8H7a1 1 0 0 1 0-2h2V4a3 3 0 0 1 3-3z"/>
        </svg>
      </button>
      <button class="icon-btn" id="approvedSupplyBtn" aria-label="Approved Supply" title="Approved Supply">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">
          <rect x="3" y="3" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"/>
          <polyline points="6 12 10 16 18 8" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Favorites Dropdown -->
  <div id="favoritesDropdown" class="favorites-dropdown" style="display: none;"></div>
  <!-- NEW: Documents Dropdown -->
  <div id="documentsDropdown" class="documents-dropdown" style="display: none;"></div>
  <!-- NEW: Audit Dropdown -->
  <div id="auditDropdown" class="documents-dropdown" style="display: none;"></div>
  <!-- NEW: Resource Management Dropdown -->
  <div id="resourceManagementDropdown" class="documents-dropdown" style="display: none;"></div>
  <!-- NEW: Approved Supply Dropdown -->
  <div id="approvedSupplyDropdown" class="documents-dropdown" style="display: none;"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <h2>Sidebar</h2>
    <ul>
      <li style="padding: 8px 0; font-weight: bold;">Quality Control</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('inspection')" style="color: #fff; text-decoration: none;">
            Inspection Database
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Resource Management</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('training')" style="color: #fff; text-decoration: none;">
            Training Management
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('purchases')" style="color: #fff; text-decoration: none;">
            Purchases
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('sales')" style="color: #fff; text-decoration: none;">
            Sales
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('inventory')" style="color: #fff; text-decoration: none;">
            Inventory
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('qcInventory')" style="color: #fff; text-decoration: none;">
            QC Inventory
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('operations')" style="color: #fff; text-decoration: none;">
            Operations
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('safety')" style="color: #fff; text-decoration: none;">
            Safety
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('operationalPlanning')" style="color: #fff; text-decoration: none;">
            Operational Planning &amp; Control
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('supplierOutsourcingControl')" style="color: #fff; text-decoration: none;">
            Supplier and Outsourcing Control
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('product')" style="color: #fff; text-decoration: none;">
            Product
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('resourceManagement')" style="color: #fff; text-decoration: none;">
            Resource Management
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('marketing')" style="color: #fff; text-decoration: none;">
            Marketing
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('purchasingNew')" style="color: #fff; text-decoration: none;">
            Purchasing
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Corrective and Preventative Actions</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('capa')" style="color: #fff; text-decoration: none;">
            Corrective and Preventive Action (CAPA)
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Measurement Analysis &amp; Improvements</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('performance')" style="color: #fff; text-decoration: none;">
            Performance Monitoring
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('opportunitiesObject')" style="color: #fff; text-decoration: none;">
            Opportunities Object
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('performanceIndicatorObject')" style="color: #fff; text-decoration: none;">
            Performance Indicator Object
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('riskOpportunityRegister')" style="color: #fff; text-decoration: none;">
            Risk &amp; Opportunity Register
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('measurementAnalysis')" style="color: #fff; text-decoration: none;">
            Measurement Analysis &amp; Improvement
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Admin</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('actionItems')" style="color: #fff; text-decoration: none;">
            Action Items Dashboard
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('history')" style="color: #fff; text-decoration: none;">
            History Log
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Approved Supply</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('amlDatabase')" style="color: #fff; text-decoration: none;">
            MRC Global AML Database
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('myAML')" style="color: #fff; text-decoration: none;">
            My AML
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('myAMLManufacturers')" style="color: #fff; text-decoration: none;">
            MyAML-Manufacturers
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('myAMLMaterials')" style="color: #fff; text-decoration: none;">
            MyAML-Materials
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('myAMLManageApprovals')" style="color: #fff; text-decoration: none;">
            MyAML-Manage Approvals
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('myAMLCustomAML')" style="color: #fff; text-decoration: none;">
            MyAML-Custom AML
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('approvedSupply')" style="color: #fff; text-decoration: none;">
            Approved Supply
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Audit</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('internalAudit')" style="color: #fff; text-decoration: none;">
            Quality Internal Audit
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('buildAudit')" style="color: #fff; text-decoration: none;">
            Build Audit
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('auditProgram')" style="color: #fff; text-decoration: none;">
            Create Audit Program
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('externalAudit')" style="color: #fff; text-decoration: none;">
            Quality External Audit
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('auditObject')" style="color: #fff; text-decoration: none;">
            Audit Object
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('audit')" style="color: #fff; text-decoration: none;">
            Audit
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Processes</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('processRegister')" style="color: #fff; text-decoration: none;">
            Process Register
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('processOwnerRegister')" style="color: #fff; text-decoration: none;">
            Process Owner Register
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('processResponsibilityMatrix')" style="color: #fff; text-decoration: none;">
            Process Responsibility Matrix
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('processes')" style="color: #fff; text-decoration: none;">
            Processes
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">People</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('userDirectory')" style="color: #fff; text-decoration: none;">
            User Directory
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('orgRoles')" style="color: #fff; text-decoration: none;">
            Organizational, Roles, Responsibilities and Authorities
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('competenceTraining')" style="color: #fff; text-decoration: none;">
            Competence, Training, and Awareness Records
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Infrastructure</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('locationsDirectory')" style="color: #fff; text-decoration: none;">
            Locations Directory
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Recall</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('recallObject')" style="color: #fff; text-decoration: none;">
            Recall Object
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Product Conformance &amp; Traceability</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('nonconformanceObject')" style="color: #fff; text-decoration: none;">
            Nonconformance Object
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('productNC')" style="color: #fff; text-decoration: none;">
            Product Nonconformance Database
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('customerNC')" style="color: #fff; text-decoration: none;">
            Customer Nonconformance Database
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('supplierNC')" style="color: #fff; text-decoration: none;">
            Supplier Nonconformance Database
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('nonconformance')" style="color: #fff; text-decoration: none;">
            Nonconformance
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('gasInspection')" style="color: #fff; text-decoration: none;">
            Gas Inspection
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('designDocumentation')" style="color: #fff; text-decoration: none;">
            Design and Development Documentation
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('subcontractorWork')" style="color: #fff; text-decoration: none;">
            Subcontractor Work
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('transportation')" style="color: #fff; text-decoration: none;">
            Transportation
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Process Conformance &amp; Traceability</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('mrcGlobalNC')" style="color: #fff; text-decoration: none;">
            MRC Global Nonconformance Database
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Leadership</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('managementReview')" style="color: #fff; text-decoration: none;">
            Management Review
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('performanceManagementReviewObject')" style="color: #fff; text-decoration: none;">
            Performance/Management Review Object
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" onclick="showSection('managementResponsibility')" style="color: #fff; text-decoration: none;">
            Management Responsibility
          </a>
        </li>
      </ul>

      <li style="padding: 8px 0; font-weight: bold;">Customer Satisfaction</li>
      <ul style="padding-left: 15px; list-style: none;">
        <li>
          <a href="javascript:void(0)" onclick="showSection('salesProjects')" style="color: #fff; text-decoration: none;">
            Sales Projects &amp; Tenders
          </a>
        </li>
      </ul>
    </ul>
  </aside>

  <!-- Home View -->
  <div id="homeView" class="main-content" style="display: none;">
    <section class="title-section">
      <h1>Welcome to MRC GLOBAL QMS</h1>
      <p>Your central hub for quality management and ISO compliance.</p>
    </section>
    <div class="home-cards">
      <a class="home-card" href="http://ww.dummyurl.co/reportNonconformance" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <h3>Report a Nonconformance</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/amlDatabase" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <rect x="4" y="4" width="16" height="16"/>
        </svg>
        <h3>Access the AML Database</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/equipmentCalibration" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <path d="M3 9.5L12 3l9 6.5V21a1 1 0 0 1-1 1h-6v-7h-4v7H4a1 1 0 0 1-1-1V9.5z" />
        </svg>
        <h3>Equipment &amp; Calibration</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/correctiveAction" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <path d="M12 2L2 7v6h20V7z" />
        </svg>
        <h3>Corrective Action Reporting</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/inspectionTesting" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <h3>Inspection &amp; Testing</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/engineeringWorkbench" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <rect x="3" y="3" width="18" height="18"/>
        </svg>
        <h3>Engineering Workbench</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/qualityTeamBios" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <h3>Quality Team Bios</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/qualityTeamOrgChart" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <rect x="4" y="4" width="16" height="16"/>
        </svg>
        <h3>Quality Team Org Chart</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/qualityPoster" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <path d="M12 2L2 7v6h20V7z" />
        </svg>
        <h3>Quality Poster</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/viewDownloadPoster" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <path d="M2 12l1.41 1.41L12 5.83l8.59 7.58L22 12l-10-9z" />
        </svg>
        <h3>View/Download Poster</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/orderPosters" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <h3>Order Posters</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/mrcGlobalQMS" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <rect x="3" y="3" width="18" height="18"/>
        </svg>
        <h3>MRC Global QMS</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/mrcGlobalNorway" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <h3>MRC Global Norway Systems</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/qualityStandDown" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <rect x="4" y="4" width="16" height="16"/>
        </svg>
        <h3>Quality Stand Down</h3>
      </a>
      <a class="home-card" href="http://ww.dummyurl.co/qualityAustralia" target="_blank">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:48px; height:48px; margin-bottom:10px;">
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <h3>Quality in Australia</h3>
      </a>
    </div>
  </div>

  <!-- Dashboard View -->
  <div id="dashboardView" class="main-content">
    <!-- Welcome and Tabs Section -->
    <section class="title-section">
      <!-- (Tabs content removed) -->
    </section>
    <!-- Body: Removed Quick Actions block -->
    <div class="body-content">
      <div id="bigButtonsContainer" class="big-buttons">
        <!-- Big buttons for each ISO QMS section will be populated here -->
      </div>
    </div>
  </div>

  <!-- Section View (Detail view for a selected module) -->
  <div id="sectionView" class="main-content section-view" style="display: none;">
    <div class="section-header">
      <button id="backToDashboard" aria-label="Back">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <h2 id="sectionTitle">Section Title</h2>
      <button id="newRecordBtn">New</button>
    </div>
    <!-- New AML Database Subsection Tabs container -->
    <div id="subsectionTabs" style="display: none;"></div>
    <div id="recordsTableContainer">
      <!-- Table of records will be rendered here -->
    </div>
  </div>

  <!-- Modal for Create/Edit Forms -->
  <div id="modal" class="modal-overlay">
    <!-- Modal content is injected dynamically -->
  </div>

  <!-- NEW Export CSV Modal Container -->
  <div id="exportModal" class="modal-overlay" style="display: none;">
    <!-- Export Modal content will be injected dynamically -->
  </div>

  <!-- NEW Notifications Modal Container -->
  <div id="notificationsModal" class="modal-overlay" style="display: none;"></div>

  <!-- NEW Admin Interface View -->
  <div id="adminView" class="main-content" style="display: none;"></div>

  <!-- NEW: User Profile Page -->
  <div id="profileView" class="main-content" style="display: none;">
    <section class="title-section" style="text-align: center;">
      <h1>User Profile</h1>
      <p>Welcome, <span id="profileUsername"></span></p>
    </section>
    <div style="text-align: center; margin-top: 20px;">
      <img id="profileAvatar" src="" alt="User Avatar" style="width:120px; height:120px; border-radius:50%;"/>
    </div>
    <div style="margin-top:20px; text-align: center;">
      <button onclick="goBack()">Back to Dashboard</button>
    </div>
  </div>

  <script>
    // Sidebar toggle
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });

    // Global Variables and Data Store for ISO QMS Sections
    let dataStore = {};
    let currentSection = "";
    let currentPurchasesSubsection = "";
    let currentSalesSubsection = "";
    let currentInventorySubsection = "";
    let currentQCInventorySubsection = "";
    let currentAMLSubsection = "";
    let currentUser = { username: "TestUser", role: "Admin" };  

    // Initialize userDirectory to prevent undefined errors in Admin Interface
    if (!dataStore.userDirectory) {
      dataStore.userDirectory = [
        { "User Name": "TestUser", "Email": "testuser@example.com", role: "Admin" }
      ];
    }

    const sections = {
      qualityDocuments: { displayName: "Quality Documents Library", fields: [
        "Category",
        "Subcategory",
        "Up for Review",
        "Name",
        "Document ID",
        "Created Date",
        "Created by",
        "Approved by",
        "Author",
        "Region",
        "System",
        "Department",
        "Document Type",
        "Document Title",
        "Filename",
        "Link",
        "Customer",
        "Supplier",
        "Topic",
        "Effective Date",
        "Last Review Date",
        "Next Review Date",
        "Owner",
        "Status",
        "Expiration Date",
        "Language",
        "Scope",
        "Comment",
        "Description",
        "Approval Status",
        "Content Type",
        "File Size",
        "Path",
        "Country",
        "Location"
      ] },
      internalAudit: { displayName: "Quality Internal Audit", fields: ["Audit Title", "Date", "Checklist", "Findings", "Notes", "Audit Result", "Region", "Country", "Location"] },
      externalAudit: { displayName: "Quality External Audit", fields: ["Audit Title", "Date", "Checklist", "Findings", "Notes", "Audit Result", "Region", "Country", "Location"] },
      managementReview: { displayName: "Management Review", fields: ["Review Title", "Date", "Comments", "Next Review Date", "Region", "Country", "Location"] },
      registerFormRepo: { displayName: "Quality Register and Form Repository", fields: ["Form Name", "Type", "Last Updated", "Region", "Country", "Location"] },
      productNC: { displayName: "Product Nonconformance Database", fields: [
        "NCRID",
        "Created Date",
        "Category",
        "Status",
        "Service Center",
        "Country",
        "Created By",
        "Assigned To",
        "Customer",
        "Customer Order",
        "Manufacturer",
        "Purchase Order",
        "Product Description",
        "Product Group",
        "Type",
        "Part ID",
        "Quality",
        "Heat/Serial",
        "Issue Description",
        "Other Information",
        "Immediate Actions Taken",
        "Investigation Notes",
        "Root-cause",
        "Action 1",
        "Action 2",
        "Action 3",
        "Action 4",
        "Final Resolution",
        "Status",
        "Pending User",
        "Last Action Date",
        "Next Review Date",
        "Value",
        "Region",
        "Country",
        "Location"
      ] },
      customerNC: { 
        displayName: "Customer Nonconformance Database", 
        fields: [
          "NCRID", 
          "Created Date", 
          "Category", 
          "Status", 
          "Service Center", 
          "Country", 
          "Created By", 
          "Assigned To", 
          "Customer", 
          "Customer Order", 
          "Manufacturer", 
          "Purchase Order", 
          "Product Description", 
          "Product Group", 
          "Type", 
          "Part ID", 
          "Quality", 
          "Heat/Serial", 
          "Issue Description", 
          "Other Information", 
          "Immediate Actions Taken", 
          "Investigation Notes", 
          "Root-cause", 
          "Action 1", 
          "Action 2", 
          "Action 3", 
          "Action 4", 
          "Final Resolution", 
          "Pending User", 
          "Last Action Date", 
          "Next Review Date", 
          "Value", 
          "Region", 
          "Location"
        ] 
      },
      supplierNC: { displayName: "Supplier Nonconformance Database", fields: [
        "NCRID",
        "Created Date",
        "Category",
        "Status",
        "Service Center",
        "Country",
        "Created By",
        "Assigned To",
        "Customer",
        "Customer Order",
        "Manufacturer",
        "Purchase Order",
        "Product Description",
        "Product Group",
        "Type",
        "Part ID",
        "Quality",
        "Heat/Serial",
        "Issue Description",
        "Other Information",
        "Immediate Actions Taken",
        "Investigation Notes",
        "Root-cause",
        "Action 1",
        "Action 2",
        "Action 3",
        "Action 4",
        "Final Resolution",
        "Status",
        "Pending User",
        "Last Action Date",
        "Next Review Date",
        "Value",
        "Region",
        "Country",
        "Location"
      ] },
      mrcGlobalNC: { displayName: "MRC Global Nonconformance Database", fields: ["NCR Title", "Date", "Description", "Root Cause", "Corrective Action", "Status", "Region", "Country", "Location"] },
      inspection: { 
        displayName: "Inspection Database", 
        fields: [
          "Inspection Title",
          "Link",
          "Date",
          "Manufacturer",
          "Customer",
          "Facility",
          "Service Center",
          "Inspector",
          "Part ID",
          "Material",
          "Quantity Received",
          "Quantity Pass",
          "Quantity Fail",
          "Defect Description",
          "NCRID",
          "Details",
          "Outcome",
          "Status",
          "Region",
          "Country",
          "Location"
        ]
      },
      training: { displayName: "Training Management", fields: ["Training Title", "Date", "Department", "Trainer", "Notes", "Region", "Country", "Location"] },
      capa: { displayName: "Corrective and Preventive Action (CAPA)", fields: ["CAPA Title", "Description", "Root Cause", "Action Plan", "Status", "Region", "Country", "Location"] },
      risk: { displayName: "Risk Management", fields: ["Risk Description", "Likelihood", "Impact", "Mitigation", "Region", "Country", "Location"] },
      performance: { displayName: "Performance Monitoring", fields: ["KPI", "Target", "Actual", "Status", "Region", "Country", "Location"] },
      actionItems: { displayName: "Action Items Dashboard", fields: ["Action", "Responsible", "Due Date", "Status", "Region", "Country", "Location"] },
      amlDatabase: { displayName: "MRC Global AML Database", fields: ["Case ID", "Client Name", "Category", "Status", "Reporting Officer", "Date Reported", "Last Updated", "Notes", "Region", "Country", "Location"], subsections: ["AML Home", "AML Manufacturers", "AML Materials", "AML Manage Approvals", "My MDL", "Custom AMLs", "AML VET Queries", "AML History", "AML Admin"] },
      myAML: { displayName: "My AML", fields: ["Case ID", "Client Name", "Category", "Status", "Reporting Officer", "Date Reported", "Last Updated", "Notes", "Region", "Country", "Location"] },
      myAMLManufacturers: { displayName: "MyAML-Manufacturers", fields: ["Company", "Legacy Name", "Brand Name(s)", "Facility Name", "City/State/Locality", "Country", "Capabilities", "Region", "Location"] },
      myAMLMaterials: { displayName: "MyAML-Materials", fields: ["Group", "Material", "Region", "Country", "Location"] },
      myAMLManageApprovals: { displayName: "MyAML-Manage Approvals", fields: ["Company", "Facility Name", "Brand Name(s)", "Country", "Approval Level", "Region", "Location"] },
      myAMLCustomAML: { displayName: "MyAML-Custom AML", fields: ["Name", "Description", "Group", "Material", "Company", "Brand", "Facility", "Country", "Status", "Region", "Location"] },
      myAVLManufacturers: { displayName: "MyAVL-Manufacturers", fields: ["Company", "Legacy Name", "Brand Name(s)", "Facility Name", "City/State/Locality", "Country", "Capabilities", "Region", "Location"] },
      myAVLMaterials: { displayName: "MyAVL-Materials", fields: ["Group", "Material", "Region", "Country", "Location"] },
      myAVLManageApprovals: { displayName: "MyAVL-Manage Approvals", fields: ["Company", "Facility Name", "Brand Name(s)", "Country", "Approval Level", "Region", "Location"] },
      myAVLCustomAML: { displayName: "MyAVL-Custom AML", fields: ["Name", "Description", "Group", "Material", "Company", "Brand", "Facility", "Country", "Status", "Region", "Location"] },
      processRegister: { displayName: "Process Register", fields: ["Process", "Subprocess", "Process Owner", "Related Process", "Support", "Region", "Country", "Location"] },
      processOwnerRegister: { displayName: "Process Owner Register", fields: ["Process", "Department", "Owner", "Region", "Country", "Location"] },
      processResponsibilityMatrix: { displayName: "Process Responsibility Matrix", fields: ["Process", "ISO 9001 2015 Clause", "Region", "Country", "Location"] },
      documentRevisionRegister: { displayName: "Document Revision Register", fields: ["Document", "Revision", "Change Description", "Date", "Changed By", "Region", "Country", "Location"] },
      userDirectory: { displayName: "User Directory", fields: ["User Name", "Email", "Phone", "Reporting Manager", "Level", "Region", "Country", "Location"] },
      locationsDirectory: { displayName: "Locations Directory", fields: ["Location ID", "Location Name", "City", "State", "Country", "Locality", "Region", "ISO Certified", "Location Manager", "Products & Services Offered", "Location"] },
      buildAudit: { displayName: "Build Audit", fields: ["Ref No.", "Clause Title", "Q-No", "Requirements/Questions", "Process", "Enter Audit Result", "Recommended Actions", "Audit Evidence & Notes", "Conforms", "Score", "Possible Root-cause", "Opportunities for Improvement", "Region", "Country", "Location"] },
      auditProgram: { displayName: "Create Audit Program", fields: ["Program Name", "Processes", "Scheduled Dates", "Status", "Region", "Country", "Location"] },
      recallObject: { displayName: "Recall Object", fields: ["Recall ID", "Product Name", "Recall Date", "Affected Inventory", "Sales Impact", "Product Nonconformance", "Status", "Region", "Country", "Location"] },
      auditObject: { displayName: "Audit Object", fields: ["Object Name", "Section", "Process", "Audit Type", "Tasks", "Process NCRs", "Status", "Notes", "Region", "Country", "Location"] },
      nonconformanceObject: { displayName: "Nonconformance Object", fields: ["Nonconformance ID", "Title", "Description", "Date Reported", "Related Audits", "Related Recalls", "Related Tasks", "Status", "Region", "Country", "Location"] },
      opportunitiesObject: { displayName: "Opportunities Object", fields: ["Opportunity ID", "Title", "Description", "Date Identified", "Related Activities", "Related Tasks", "Status", "Region", "Country", "Location"] },
      performanceIndicatorObject: { displayName: "Performance Indicator Object", fields: ["KPI", "Target", "Actual", "Status", "Related Activities", "Related Tasks", "Region", "Country", "Location"] },
      riskMitigationObject: { displayName: "Risk Mitigation Object", fields: ["Risk ID", "Risk Description", "Likelihood", "Impact", "Mitigation Plan", "Related Activities", "Related Tasks", "Status", "Region", "Country", "Location"] },
      performanceManagementReviewObject: { displayName: "Performance/Management Review Object", fields: ["Review Title", "Review Date", "Comments", "Related Activities", "Related Tasks", "Region", "Country", "Location"] },
      purchases: { displayName: "Purchases", fields: ["Item ID", "Description", "Spec", "Location", "Manufacturer", "Supplier", "PO", "PO Line", "Customer(s)", "Comments", "Region", "Country"], subsections: ["Stock Purchases", "Buyout Purchases", "Vendor Direct Purchases"] },
      sales: { displayName: "Sales", fields: ["Item ID", "Descriptions", "Spec", "Location", "Manufacturer", "Supplier", "Customer Order", "Customer Order Line", "Sales Order", "Sales Order Line", "Vendor PO", "Vendor PO Line", "Comments", "Region", "Country"], subsections: ["Stock Sales", "Buyout Sales", "Vendor Direct Sales"] },
      inventory: { displayName: "Inventory", fields: ["Item ID", "Description", "Spec", "Location", "Sourced Location", "Transferred From location", "Transaction Type", "Transaction ID", "Transaction Quantity", "Audit Method", "Region", "Country"], subsections: ["Stock Inventory", "Buyout Inventory", "Vendor Direct Inventory"] },
      qcInventory: { displayName: "QC Inventory", fields: ["Item ID", "Description", "Spec", "Location", "Sourced Location", "Transferred From location", "Transaction Type", "Transaction ID", "Transaction Quantity", "Audit Method", "Region", "Country"], subsections: ["Stock Inventory", "Buyout Inventory", "Vendor Direct Inventory"] },
      calibration: { displayName: "Calibration", fields: ["Global ID", "Location", "On-Site Location", "Location ID", "Link", "Title", "Date Last Calibrated", "Status", "Region", "Country"] },
      operations: { displayName: "Operations", fields: ["Initiative", "Metric", "Target", "Actual", "Status", "Owner", "Comments", "Date", "Region", "Country", "Location"] },
      safety: { displayName: "Safety", fields: ["Safety Process", "Procedure", "Incident Description", "Corrective Action", "Status", "Date", "Responsible", "Region", "Country", "Location"] },
      interestedParties: { displayName: "Interested Parties", fields: ["Party Name", "Role", "Contact Person", "Email", "Phone", "Address", "Notes", "Region", "Country", "Location"] },
      riskOpportunityRegister: { displayName: "Risk & Opportunity Register", fields: ["Record Type", "ID", "Title", "Description", "Likelihood", "Impact", "Plan", "Date Identified", "Related Activities", "Related Tasks", "Status", "Region", "Country", "Location"] },
      qmsScope: { displayName: "QMS Scope", fields: ["Scope Description", "Processes Covered", "Reference", "Region", "Country", "Location"] },
      qualityPolicy: { displayName: "Quality Policy", fields: ["Policy Statement", "Customer Requirements", "Regulatory Requirements", "Continual Improvement", "Stakeholder Needs", "Reference", "Region", "Country", "Location"] },
      qualityObjectives: { displayName: "Quality Objectives", fields: ["Objective Statement", "Metric", "Target", "Current Performance", "Remarks", "Reference", "Region", "Country", "Location"] },
      orgRoles: { displayName: "Organizational, Roles, Responsibilities and Authorities", fields: ["Department", "Role/Position", "Responsibilities", "Authorities", "Reference", "Region", "Country", "Location"] },
      docRecordControl: { displayName: "Document and Record Control Procedure", fields: ["Procedure Statement", "Creation Process", "Approval Process", "Storage Method", "Update Process", "Reference", "Region", "Country", "Location"] },
      competenceTraining: { displayName: "Competence, Training, and Awareness Records", fields: ["Employee Name", "Job Role", "Competence Level", "Training Needs Identified", "Training Performed", "Training Date", "Effectiveness Evaluation", "Region", "Country", "Location"] },
      operationalPlanning: { displayName: "Operational Planning & Control", fields: ["Planning Steps", "Design Procedures", "Delivery Process", "Project Management", "Flowchart", "Reference", "Region", "Country", "Location"] },
      designDocumentation: { displayName: "Design and Development Documentation", fields: ["Design Inputs", "Design Outputs", "Verification", "Validation", "Design Changes", "Reference", "Region", "Country", "Location"] },
      supplierOutsourcingControl: { displayName: "Supplier and Outsourcing Control", fields: ["Provider Name", "Vendor Type", "Selection Process", "Evaluation Criteria", "Monitoring Process", "Conformance Status", "Notes", "Reference", "Region", "Country", "Location"] },
      product: { displayName: "Product", fields: ["Product Name", "SKU", "Category", "Price", "Description", "Region", "Country", "Location"] },
      history: { displayName: "History Log", fields: ["Table", "Action", "Action Date", "User", "Fields Changed", "Old Values", "New Values"] },
      documents: { 
        displayName: "Documents",
        fields: ["Title", "Description", "File", "Region", "Country", "Location"]
      },
      processes: { 
        displayName: "Processes",
        fields: ["Process Name", "Description", "Flowchart", "Region", "Country", "Location"]
      },
      approvedSupply: {
        displayName: "Approved Supply",
        fields: ["Supplier Name", "Approved Date", "Product", "Region", "Country", "Location"]
      },
      audit: {
        displayName: "Audit",
        fields: ["Audit Title", "Date", "Checklist", "Findings", "Notes", "Region", "Country", "Location"]
      },
      nonconformance: {
        displayName: "Nonconformance",
        fields: ["Nonconformance ID", "Description", "Date Reported", "Corrective Action", "Status", "Region", "Country", "Location"]
      },
      gasInspection: {
        displayName: "Gas Inspection",
        fields: ["Inspection ID", "Gas Type", "Date", "Results", "Inspector", "Region", "Country", "Location"]
      },
      managementResponsibility: {
        displayName: "Management Responsibility",
        fields: ["Responsibility Title", "Description", "Date", "Region", "Country", "Location"]
      },
      resourceManagement: {
        displayName: "Resource Management",
        fields: ["Resource Name", "Type", "Allocation", "Status", "Region", "Country", "Location"]
      },
      measurementAnalysis: {
        displayName: "Measurement Analysis & Improvement",
        fields: ["Metric", "Target", "Actual", "Improvement Plan", "Region", "Country", "Location"]
      },
      marketing: {
        displayName: "Marketing",
        fields: ["Campaign Name", "Start Date", "End Date", "Budget", "Region", "Country", "Location"]
      },
      purchasingNew: {
        displayName: "Purchasing",
        fields: ["Item", "Vendor", "Cost", "Quantity", "Region", "Country", "Location"]
      },
      salesProjects: {
        displayName: "Sales Projects & Tenders",
        fields: ["Project Name", "Tender ID", "Client", "Due Date", "Region", "Country", "Location"]
      },
      warehousing: {
        displayName: "Warehousing",
        fields: ["Warehouse ID", "Location", "Capacity", "Manager", "Region", "Country", "Location"]
      },
      shopWork: {
        displayName: "Shop Work",
        fields: ["Job ID", "Description", "Assigned To", "Status", "Region", "Country", "Location"]
      },
      transportation: {
        displayName: "Transportation",
        fields: ["Transport ID", "Vehicle", "Driver", "Route", "Status", "Region", "Country", "Location"]
      },
      subcontractorWork: {
        displayName: "Subcontractor Work",
        fields: ["Work ID", "Subcontractor", "Project", "Contract Value", "Status", "Region", "Country", "Location"]
      },
      checklistCreator: { displayName: "Checklist Creator", fields: [] },
      workInstructionCreator: { 
        displayName: "Work Instruction Creator", 
        fields: ["Title", "Description", "Steps", "Tools Required", "Safety Precautions", "Created Date", "Status"] 
      },
      pdca: { displayName: "PDCA Cycle", fields: ["Plan", "Do", "Check", "Act", "Review Date", "Status", "Comments"] },
      pestleAnalysis: { 
        displayName: "PESTLE Analysis", 
        fields: [
          "Political Factors", 
          "Economic Factors", 
          "Social Factors", 
          "Technological Factors", 
          "Legal Factors", 
          "Environmental Factors", 
          "Overall Assessment", 
          "Analysis Date"
        ]
      },
      eightDAnalysis: { 
        displayName: "8D Analysis", 
        fields: [
          "Team", 
          "Problem Description", 
          "Containment Actions", 
          "Root Cause", 
          "Corrective Actions", 
          "Preventive Actions", 
          "Verification", 
          "Lessons Learned", 
          "D1 - Identify Team", 
          "D2 - Describe the Problem", 
          "D3 - Interim Containment Action (ICA)", 
          "D4 - Root Cause Analysis", 
          "D5 - Choose Corrective Actions", 
          "D6 - Implement and Validate", 
          "D7 - Prevent Recurrence", 
          "D8 - Congratulate the Team", 
          "Analysis Date"
        ]
      },
      fiveWhyAnalysis: { 
        displayName: "5 Why Analysis", 
        fields: [
          "Problem Statement", 
          "Why 1", 
          "Why 2", 
          "Why 3", 
          "Why 4", 
          "Why 5", 
          "Root Cause", 
          "Analysis Date"
        ]
      },
      rootCauseAnalysis: { 
        displayName: "Root Cause Analysis", 
        fields: [
          "Problem", 
          "Contributing Factors", 
          "Root Cause", 
          "Analysis Method", 
          "Analysis Date"
        ]
      },
      correctiveAction: { 
        displayName: "Corrective Action", 
        fields: [
          "Issue", 
          "Root Cause", 
          "Corrective Action Plan", 
          "Implementation Date", 
          "Verification", 
          "Status", 
          "Comments"
        ]
      },
      progress: { 
        displayName: "Progress", 
        fields: [
          "Task", 
          "Assignee", 
          "Status", 
          "Start Date", 
          "Due Date", 
          "Progress Percentage", 
          "Comments"
        ]
      },
      ifd: { 
        displayName: "IFD", 
        fields: [
          "Title", 
          "Date", 
          "Findings", 
          "Decisions", 
          "Recommendations", 
          "Follow-up Actions"
        ]
      },
      themeManager: { displayName: "Theme Manager", fields: [] }
    };

    const sectionBlurbs = {
      qualityDocuments: "Provides the documentation backbone for the QMS, referencing ISO 9001:2015 Clause 7.5.",
      internalAudit: "Ensures internal controls and continuous improvement per ISO 9001:2015 Clause 9.2.",
      externalAudit: "Verifies external process compliance following ISO 9001:2015 Clause 9.2.",
      managementReview: "Facilitates top management oversight to ensure QMS effectiveness (ISO 9001:2015 Clause 9.3).",
      registerFormRepo: "Stores quality registers and forms to support documented procedures.",
      productNC: "Tracks product nonconformance to drive corrective actions per ISO 9001:2015 Clause 8.7.",
      customerNC: "Addresses customer nonconformance to uphold quality standards.",
      supplierNC: "Monitors supplier issues and improves supplier quality as in ISO 9001:2015 Clause 8.4.",
      mrcGlobalNC: "Manages global nonconformance events to support corrective processes.",
      inspection: "Conducts inspections to verify adherence with quality requirements (ISO 9001:2015 Clause 8.5).",
      training: "Manages training records to ensure employee competence per ISO 9001:2015 Clause 7.2.",
      capa: "Implements corrective and preventive actions aligned with ISO 9001:2015 Clause 10.2.",
      risk: "Identifies and mitigates risks as required by ISO 9001:2015 Clause 6.1.",
      performance: "Monitors key performance indicators driving continual improvement (ISO 9001:2015 Clause 9.1).",
      actionItems: "Tracks actionable items to ensure timely quality improvements.",
      amlDatabase: "Manages AML data ensuring regulatory and quality compliance.",
      myAML: "Monitors individual AML records for continuous improvement.",
      myAMLManufacturers: "Oversees manufacturer approvals to secure product quality.",
      myAMLMaterials: "Ensures material quality and traceability throughout the process.",
      myAMLManageApprovals: "Tracks approval statuses to maintain control over quality processes.",
      processRegister: "Documents core processes supporting QMS per ISO 9001:2015 Clause 4.4.",
      processOwnerRegister: "Lists process owners for accountability in the QMS.",
      processResponsibilityMatrix: "Clarifies roles and responsibilities to support an effective QMS.",
      documentRevisionRegister: "Tracks document changes ensuring currency per ISO 9001:2015 Clause 7.5.",
      userDirectory: "Maintains a directory of users to support communication and process ownership.",
      locationsDirectory: "Keeps location records for operational audits and quality checks.",
      buildAudit: "Records audit findings to facilitate continual improvement (ISO 9001:2015 Clause 9.2).",
      auditProgram: "Schedules audits to uphold compliance with ISO standards.",
      recallObject: "Tracks product recalls to quickly address quality issues.",
      auditObject: "Stores audit records to support corrective actions and improvements.",
      nonconformanceObject: "Logs nonconformance events to trigger corrective actions.",
      opportunitiesObject: "Identifies areas for improvement within the QMS.",
      performanceIndicatorObject: "Monitors performance metrics driving quality improvements.",
      riskMitigationObject: "Manages risk mitigation plans in line with ISO 9001:2015 requirements.",
      performanceManagementReviewObject: "Supports management reviews to drive QMS enhancements.",
      purchases: "Documents procurement processes to ensure quality and compliance.",
      sales: "Oversees sales operations aligning with customer quality requirements.",
      inventory: "Tracks inventory movements to maintain supply chain quality.",
      qcInventory: "Manages quality control records for inventory integrity.",
      calibration: "Ensures equipment calibration per ISO 9001:2015 Clause 7.1.",
      operations: "Monitors operational activities to support continual quality improvement.",
      safety: "Manages safety inspections to uphold workplace and product quality standards.",
      interestedParties: "Documents stakeholders details to enhance QMS communication.",
      riskOpportunityRegister: "Logs risks and opportunities to guide strategic planning.",
      qmsScope: "Defines the scope of the QMS as per ISO 9001:2015 Clause 4.3.",
      qualityPolicy: "Communicates the organizations quality commitment (ISO 9001:2015 Clause 5.2).",
      qualityObjectives: "Sets measurable quality objectives driving systematic improvement.",
      orgRoles: "Defines organizational roles to ensure clear accountability within the QMS.",
      docRecordControl: "Controls document processes in line with ISO 9001:2015 Clause 7.5.",
      competenceTraining: "Tracks training activities to maintain competence per ISO 9001:2015 Clause 7.2.",
      operationalPlanning: "Supports planning and execution of quality operations (ISO 9001:2015 Clause 8.1).",
      designDocumentation: "Documents design processes ensuring compliance and quality.",
      supplierOutsourcingControl: "Oversees supplier and outsourcing quality per ISO 9001:2015 Clause 8.4.",
      product: "Manages product information to guarantee market quality and competitiveness.",
      history: "Provides an audit trail of all changes to bolster continuous improvement.",
      documents: "Centralizes documents supporting the QMS integrity.",
      processes: "Captures business processes to promote consistent quality standards.",
      approvedSupply: "Tracks approved suppliers to ensure consistent product quality.",
      audit: "Facilitates audit activities to drive process improvements.",
      nonconformance: "Monitors nonconformance to trigger timely corrective measures.",
      gasInspection: "Manages gas inspection records for improved operational safety.",
      managementResponsibility: "Clarifies management duties in overseeing the QMS.",
      resourceManagement: "Ensures efficient resource allocation to support quality processes.",
      measurementAnalysis: "Analyzes performance data to drive improvements (ISO 9001:2015 Clause 9.1).",
      marketing: "Aligns marketing practices with overall quality objectives.",
      purchasingNew: "Handles new purchasing data to maintain supplier reliability and quality.",
      salesProjects: "Oversees sales initiatives ensuring adherence to quality standards.",
      warehousing: "Ensures warehousing operations maintain product quality and integrity.",
      shopWork: "Documents shop-floor activities to support robust quality control.",
      transportation: "Manages transportation logistics to assure timely delivery and quality.",
      subcontractorWork: "Monitors subcontractor operations ensuring compliance with quality standards.",
      checklistCreator: { displayName: "Checklist Creator", fields: [] },
      workInstructionCreator: { 
        displayName: "Work Instruction Creator", 
        fields: ["Title", "Description", "Steps", "Tools Required", "Safety Precautions", "Created Date", "Status"] 
      },
      pdca: { displayName: "PDCA Cycle", fields: ["Plan", "Do", "Check", "Act", "Review Date", "Status", "Comments"] },
      pestleAnalysis: { 
        displayName: "PESTLE Analysis", 
        fields: [
          "Political Factors", 
          "Economic Factors", 
          "Social Factors", 
          "Technological Factors", 
          "Legal Factors", 
          "Environmental Factors", 
          "Overall Assessment", 
          "Analysis Date"
        ]
      },
      eightDAnalysis: { 
        displayName: "8D Analysis", 
        fields: [
          "Team", 
          "Problem Description", 
          "Containment Actions", 
          "Root Cause", 
          "Corrective Actions", 
          "Preventive Actions", 
          "Verification", 
          "Lessons Learned", 
          "D1 - Identify Team", 
          "D2 - Describe the Problem", 
          "D3 - Interim Containment Action (ICA)", 
          "D4 - Root Cause Analysis", 
          "D5 - Choose Corrective Actions", 
          "D6 - Implement and Validate", 
          "D7 - Prevent Recurrence", 
          "D8 - Congratulate the Team", 
          "Analysis Date"
        ]
      },
      fiveWhyAnalysis: { 
        displayName: "5 Why Analysis", 
        fields: [
          "Problem Statement", 
          "Why 1", 
          "Why 2", 
          "Why 3", 
          "Why 4", 
          "Why 5", 
          "Root Cause", 
          "Analysis Date"
        ]
      },
      rootCauseAnalysis: { 
        displayName: "Root Cause Analysis", 
        fields: [
          "Problem", 
          "Contributing Factors", 
          "Root Cause", 
          "Analysis Method", 
          "Analysis Date"
        ]
      },
      correctiveAction: { 
        displayName: "Corrective Action", 
        fields: [
          "Issue", 
          "Root Cause", 
          "Corrective Action Plan", 
          "Implementation Date", 
          "Verification", 
          "Status", 
          "Comments"
        ]
      },
      progress: { 
        displayName: "Progress", 
        fields: [
          "Task", 
          "Assignee", 
          "Status", 
          "Start Date", 
          "Due Date", 
          "Progress Percentage", 
          "Comments"
        ]
      },
      ifd: { 
        displayName: "IFD", 
        fields: [
          "Title", 
          "Date", 
          "Findings", 
          "Decisions", 
          "Recommendations", 
          "Follow-up Actions"
        ]
      },
      themeManager: { displayName: "Theme Manager", fields: [] }
    };

    // Add test records for specific sections
    dataStore["qualityDocuments"] = [{
      "Category": "Procedure",
      "Subcategory": "Quality Procedure",
      "Up for Review": "Yes",
      "Name": "QMS Manual",
      "Document ID": "QD001",
      "Created Date": "2023-09-15",
      "Created by": "Alice",
      "Approved by": "Bob",
      "Author": "Alice",
      "Region": "Global",
      "System": "QMS",
      "Department": "Quality",
      "Document Type": "Manual",
      "Document Title": "QMS Manual",
      "Filename": "QMS_Manual.pdf",
      "Link": "http://example.com/qms-manual",
      "Customer": "",
      "Supplier": "",
      "Topic": "Quality Management",
      "Effective Date": "2023-09-15",
      "Last Review Date": "2023-10-10",
      "Next Review Date": "2024-04-10",
      "Owner": "Quality Manager",
      "Status": "Active",
      "Expiration Date": "",
      "Language": "English",
      "Scope": "Global",
      "Comment": "",
      "Description": "Quality Management System Manual",
      "Approval Status": "Approved",
      "Content Type": "PDF",
      "File Size": "1MB",
      "Path": "/qms-manual",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["internalAudit"] = [{
      "Audit Title": "Internal Audit Q3",
      "Date": "2023-09-30",
      "Checklist": "Checklist-IA-001",
      "Findings": "Minor nonconformance",
      "Notes": "Follow up recommended",
      "Audit Result": "Pass",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["externalAudit"] = [{
      "Audit Title": "External Audit FY2023",
      "Date": "2023-08-20",
      "Checklist": "Checklist-EA-002",
      "Findings": "No major issues",
      "Notes": "Good performance overall",
      "Audit Result": "Pass",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["managementReview"] = [{
      "Review Title": "Management Review Meeting",
      "Date": "2023-10-01",
      "Comments": "Discussed improvement actions and performance metrics.",
      "Next Review Date": "2024-01-15",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["registerFormRepo"] = [{
      "Form Name": "Incident Report",
      "Type": "Form",
      "Last Updated": "2023-09-20",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["productNC"] = [{
      "NCRID": "NC001",
      "Created Date": "2023-09-25",
      "Category": "Material Defect",
      "Status": "Open",
      "Service Center": "Main Service Center",
      "Country": "USA",
      "Created By": "Alice",
      "Assigned To": "Bob",
      "Customer": "Customer X",
      "Customer Order": "CO001",
      "Manufacturer": "Manufacturer A",
      "Purchase Order": "PO001",
      "Product Description": "Test Product",
      "Product Group": "Test Group",
      "Type": "Material",
      "Part ID": "PART001",
      "Quality": "High",
      "Heat/Serial": "123456",
      "Issue Description": "Material defect found in product",
      "Other Information": "Additional details about the issue",
      "Immediate Actions Taken": "Stopped production",
      "Investigation Notes": "Investigation in progress",
      "Root-cause": "Material flaw",
      "Action 1": "Replace materials",
      "Action 2": "Improve quality control",
      "Action 3": "Train staff",
      "Action 4": "Review procedures",
      "Final Resolution": "Corrective actions implemented",
      "Status": "Closed",
      "Pending User": "",
      "Last Action Date": "2023-10-05",
      "Next Review Date": "2024-04-05",
      "Value": "100",
      "Region": "East",
      "Country": "USA",
      "Location": "Main Location"
    }];

    dataStore["customerNC"] = [{
      "NCR Title": "Customer NC Sample",
      "Date": "2023-10-12",
      "Description": "Late delivery to customer",
      "Root Cause": "Logistics issue",
      "Corrective Action": "Improve scheduling",
      "Status": "Closed",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["supplierNC"] = [{
      "NCR Title": "Supplier NC Sample",
      "Date": "2023-10-13",
      "Description": "Low quality materials received",
      "Root Cause": "Inadequate QC at supplier",
      "Corrective Action": "Switch supplier",
      "Status": "Open",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["mrcGlobalNC"] = [{
      "NCR Title": "Global NC Process Error",
      "Date": "2023-10-14",
      "Description": "Global process misalignment",
      "Root Cause": "Procedure misinterpretation",
      "Corrective Action": "Conduct training",
      "Status": "Pending",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["inspection"] = [{
      "Inspection Title": "Safety Inspection",
      "Date": "2023-10-10",
      "Details": "Inspection of safety equipment",
      "Outcome": "Pass",
      "Status": "Completed",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["training"] = [{
      "Training Title": "Workplace Safety",
      "Date": "2023-10-05",
      "Department": "Operations",
      "Trainer": "John Smith",
      "Notes": "All participants completed training.",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["capa"] = [{
      "CAPA Title": "CAPA Improvement",
      "Description": "Addressed corrective measures in production",
      "Root Cause": "Process lapse",
      "Action Plan": "Revise SOP",
      "Status": "In Progress",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["risk"] = [{
      "Risk Description": "Operational risk due to outdated equipment",
      "Likelihood": "Medium",
      "Impact": "High",
      "Mitigation": "Upgrade machinery",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["performance"] = [{
      "KPI": "On-Time Delivery",
      "Target": "95%",
      "Actual": "92%",
      "Status": "Slightly Below Target",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["actionItems"] = [{
      "Action": "Review QMS procedures",
      "Responsible": "Team Lead",
      "Due Date": "2023-11-01",
      "Status": "Pending",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["processRegister"] = [{
      "Process": "Order Processing",
      "Subprocess": "Payment Verification",
      "Process Owner": "Manager A",
      "Related Process": "Shipping Coordination",
      "Support": "IT Support",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["processResponsibilityMatrix"] = [{
      "Process": "Order Fulfillment",
      "ISO 9001 2015 Clause": "Clause 7.1",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["documentRevisionRegister"] = [{
      "Document": "Quality Manual",
      "Revision": "Rev 2",
      "Change Description": "Updated quality procedures",
      "Date": "2023-10-18",
      "Changed By": "Alice",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["amlDatabase"] = [{
      "Case ID": "AML001",
      "Client Name": "Acme Corp",
      "Category": "High Risk",
      "Status": "Pending",
      "Reporting Officer": "Alice",
      "Date Reported": "2023-10-16",
      "Last Updated": "2023-10-17",
      "Notes": "Initial report",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["calibration"] = [{
      "Global ID": "CAL001",
      "Location": "Facility A",
      "On-Site Location": "Room 101",
      "Location ID": "LOC-CAL-01",
      "Link": "http://example.com/calibration/CAL001",
      "Title": "Pressure Gauge Calibration",
      "Date Last Calibrated": "2023-10-20",
      "Status": "Calibrated",
      "Region": "Test Region",
      "Country": "Test Country"
    }];

    dataStore["operations"] = [{
      "Initiative": "Increase Production Efficiency",
      "Metric": "Units per hour",
      "Target": "120",
      "Actual": "110",
      "Status": "On Track",
      "Owner": "Operations Manager",
      "Comments": "Process improvements underway",
      "Date": "2023-10-22",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["safety"] = [{
      "Safety Process": "Machine Guarding",
      "Procedure": "Monthly inspection and maintenance",
      "Incident Description": "No incidents reported",
      "Corrective Action": "N/A",
      "Status": "Compliant",
      "Date": "2023-10-21",
      "Responsible": "Safety Officer",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["processOwnerRegister"] = [{
      "Process": "Order Processing",
      "Department": "Operations",
      "Owner": "Jane Doe",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["interestedParties"] = [{
      "Party Name": "Acme Corporation",
      "Role": "Supplier",
      "Contact Person": "Jane Doe",
      "Email": "jane@acme.com",
      "Phone": "555-1234",
      "Address": "123 Industrial Way, City, Country",
      "Notes": "Preferred vendor for raw materials.",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["riskOpportunityRegister"] = [
      {
        "Record Type": "Risk",
        "ID": "R101",
        "Title": "Supply Chain Disruption",
        "Description": "Risk associated with relying on a single supplier in an unstable region.",
        "Likelihood": "High",
        "Impact": "Severe",
        "Plan": "Diversify supplier base, develop contingency plan.",
        "Date Identified": "2023-10-25",
        "Related Activities": "Supplier evaluation, contingency planning",
        "Related Tasks": "Issue RFP for new suppliers, review contract terms",
        "Status": "Open",
        "Region": "Test Region",
        "Country": "Test Country",
        "Location": "Test Location"
      },
      {
        "Record Type": "Opportunity",
        "ID": "O202",
        "Title": "Market Expansion",
        "Description": "Opportunity to capture market share in emerging regions.",
        "Likelihood": "Medium",
        "Impact": "High",
        "Plan": "Develop targeted marketing strategies.",
        "Date Identified": "2023-10-20",
        "Related Activities": "Market analysis, strategy planning",
        "Related Tasks": "Competitive benchmarking, budget allocation",
        "Status": "In Progress",
        "Region": "Test Region",
        "Country": "Test Country",
        "Location": "Test Location"
      }
    ];

    dataStore["qmsScope"] = [{
      "Scope Description": "Define the boundaries and applicability of the QMS including services and products provided.",
      "Processes Covered": "Design, Production, Service, and Support processes.",
      "Reference": "ISO 9001:2015, Clause 4.3 - Determining the scope of the quality management system",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["qualityPolicy"] = [{
      "Policy Statement": "Our organization is committed to delivering high-quality products and services that consistently exceed expectations.",
      "Customer Requirements": "We prioritize customer satisfaction by aligning our processes with customer needs and feedback.",
      "Regulatory Requirements": "We adhere strictly to all applicable regulations and industry standards.",
      "Continual Improvement": "We foster an environment of continual improvement through regular training and process optimization.",
      "Stakeholder Needs": "We actively consider the needs of our customers, employees, suppliers, and community in our operations.",
      "Reference": "ISO 9001:2015, Clause 5.2.2 (Communicating the quality policy)",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["qualityObjectives"] = [{
      "Objective Statement": "Improve on-time delivery",
      "Metric": "On-Time Delivery (%)",
      "Target": "95%",
      "Current Performance": "90%",
      "Remarks": "Vendor delays causing issues",
      "Reference": "ISO 9001:2015, Clause 6.2 (Quality objectives and planning to achieve them)",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["orgRoles"] = [{
      "Department": "Quality Management",
      "Role/Position": "Quality Manager",
      "Responsibilities": "Oversee QMS implementation and ensure accountability",
      "Authorities": "Approve policies and delegate roles",
      "Reference": "ISO 9001:2015, Clause 5.3",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["docRecordControl"] = [{
      "Procedure Statement": "Ensure documents remain readily identifiable, legible, and properly authorized.",
      "Creation Process": "Documents are created using approved templates with built-in version control.",
      "Approval Process": "Designated managers review and formally approve each document.",
      "Storage Method": "Documents are stored in a secure, searchable digital repository with restricted access.",
      "Update Process": "Regular reviews and updates are performed to maintain document accuracy and currency.",
      "Reference": "ISO 9001:2015, Clause 7.5 (Documented information)",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["competenceTraining"] = [{
      "Employee Name": "John Doe",
      "Job Role": "Quality Supervisor",
      "Competence Level": "High",
      "Training Needs Identified": "Needs regular ISO updates",
      "Training Performed": "Attended ISO 9001 workshop",
      "Training Date": "2023-10-15",
      "Effectiveness Evaluation": "Improved performance noted",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["operationalPlanning"] = [{
      "Planning Steps": "Define scope, allocate resources, and establish schedule",
      "Design Procedures": "Develop prototypes and obtain design approvals",
      "Delivery Process": "Assemble product, perform quality checks, and deliver to client",
      "Project Management": "Monitor milestones, manage risks, and adjust plan as needed",
      "Flowchart": "Start -> Planning -> Design -> Production -> Quality Check -> Delivery -> End",
      "Reference": "ISO 9001:2015, Clause 8.1 (Operational planning and control)",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["designDocumentation"] = [{
      "Design Inputs": "Stakeholder requirements and regulatory standards",
      "Design Outputs": "Product specifications, sketches, and prototypes",
      "Verification": "Internal design reviews and simulation tests",
      "Validation": "Field trials and customer feedback",
      "Design Changes": "Version logs and approval process",
      "Reference": "ISO 9001:2015, Clause 8.3 (Design and development of products and services)",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["supplierOutsourcingControl"] = [{
      "Provider Name": "Acme Supplies",
      "Vendor Type": "Subcontractor",
      "Selection Process": "Pre-qualified vendor list and competitive bidding",
      "Evaluation Criteria": "Quality, Cost, and Delivery Time",
      "Monitoring Process": "Quarterly performance review",
      "Conformance Status": "Conforming",
      "Notes": "Meets all requirements with minor improvement suggestions.",
      "Reference": "ISO 9001:2015, Clause 8.4 (Control of externally provided processes, products, and services)",
      "Region": "Test Region",
      "Country": "Test Country",
      "Location": "Test Location"
    }];

    dataStore["history"] = dataStore["history"] || [];

    // Helper function to map current Purchases subsection to its datastore key
    function getPurchasesSubKey() {
      if (!currentPurchasesSubsection) {
        currentPurchasesSubsection = sections['purchases'].subsections[0];
      }
      if (currentPurchasesSubsection === "Stock Purchases") {
        return "purchases_stock";
      } else if (currentPurchasesSubsection === "Buyout Purchases") {
        return "purchases_buyout";
      } else if (currentPurchasesSubsection === "Vendor Direct Purchases") {
        return "purchases_vendor";
      }
      return "purchases_stock";
    }

    // Helper function to map current Sales subsection to its datastore key
    function getSalesSubKey() {
      if (!currentSalesSubsection) {
        currentSalesSubsection = sections['sales'].subsections[0];
      }
      if (currentSalesSubsection === "Stock Sales") {
        return "sales_stock";
      } else if (currentSalesSubsection === "Buyout Sales") {
        return "sales_buyout";
      } else if (currentSalesSubsection === "Vendor Direct Sales") {
        return "sales_vendor";
      }
      return "sales_stock";
    }

    // Helper function to map current Inventory subsection to its datastore key
    function getInventorySubKey() {
      if (!currentInventorySubsection) {
        currentInventorySubsection = sections['inventory'].subsections[0];
      }
      if (currentInventorySubsection === "Stock Inventory") {
        return "inventory_stock";
      } else if (currentInventorySubsection === "Buyout Inventory") {
        return "inventory_buyout";
      } else if (currentInventorySubsection === "Vendor Direct Inventory") {
        return "inventory_vendor";
      }
      return "inventory_stock";
    }

    function getQCInventorySubKey() {
      if (!currentQCInventorySubsection) {
        currentQCInventorySubsection = sections['qcInventory'].subsections[0];
      }
      if (currentQCInventorySubsection === "Stock Inventory") {
        return "qcInventory_stock";
      } else if (currentQCInventorySubsection === "Buyout Inventory") {
        return "qcInventory_buyout";
      } else if (currentQCInventorySubsection === "Vendor Direct Inventory") {
        return "qcInventory_vendor";
      }
      return "qcInventory_stock";
    }

    // Initialize Dashboard with Big Buttons for each section
    function initDashboard() {
      renderDashboardSections("");
    }

    // Function to render Dashboard view (hide section view)
    function renderDashboard() {
      document.getElementById('homeView').style.display = "none";
      document.getElementById('dashboardView').style.display = "";
      document.getElementById('sectionView').style.display = "none";
    }

    // Function to show a specific section view
    function showSection(sectionKey) {
      currentSection = sectionKey;
      document.getElementById('sectionTitle').textContent = sections[sectionKey].displayName;
      document.getElementById('dashboardView').style.display = "none";
      document.getElementById('sectionView').style.display = "";
      
      if (sectionKey === 'amlDatabase') {
        renderAMLSubsections();
      } else if (sectionKey === 'purchases') { 
        renderPurchasesSubsections();
      } else if (sectionKey === 'sales') {
        renderSalesSubsections();
      } else if (sectionKey === 'inventory') {  
        renderInventorySubsections();
      } else if (sectionKey === 'qcInventory') {  
        renderQCInventorySubsections();
      } else if (sectionKey === "checklistCreator") {
        renderChecklistCreator();
      } else if (sectionKey === "workInstructionCreator") {
        renderWorkInstructionCreator();
      } else if (sectionKey === "themeManager") {
        renderThemeManager();
      } else {
        document.getElementById('subsectionTabs').style.display = "none";
        renderRecordsTable();
      }
    }

    // New function to show Home view
    function showHome() {
      renderDashboard();
    }

    // Render table of records for current section
    function renderRecordsTable() {
      let records;
      if (currentSection === "purchases") {
        let subKey = getPurchasesSubKey();
        records = dataStore[subKey] || [];
      } else if (currentSection === "sales") {
        let subKey = getSalesSubKey();
        records = dataStore[subKey] || [];
      } else if (currentSection === "inventory") {  
        let subKey = getInventorySubKey();
        records = dataStore[subKey] || [];
      } else if (currentSection === "qcInventory") {  
        let subKey = getQCInventorySubKey();
        records = dataStore[subKey] || [];
      } else {
        records = dataStore[currentSection] || [];
      }
      const fields = sections[currentSection].fields;
      let tableHTML = '<table class="records-table"><thead><tr>';
      fields.forEach(field => {
        tableHTML += '<th>' + field + '</th>';
      });
      tableHTML += '<th>Actions</th></tr></thead><tbody>';
      let query = searchInput.value.trim().toLowerCase();
      if (query) {
        records = records.filter(record => {
          return fields.some(field => ((record[field] || "").toString().toLowerCase().includes(query)));
        });
      }
      records.forEach((record, index) => {
        tableHTML += '<tr>';
        fields.forEach(field => {
          tableHTML += '<td>' + (record[field] || '') + '</td>';
        });
        if (currentSection === "buildAudit") {
          tableHTML += '<td>';
          tableHTML += '<button onclick="editRecord(\'buildAudit\','+index+')">Edit</button> ';
          tableHTML += '<button onclick="openAudit('+index+')">Open</button> ';
          tableHTML += '<button onclick="exportRecordCSV(\'buildAudit\','+index+')">Export CSV</button> ';
          tableHTML += '<button onclick="deleteRecord(\'buildAudit\','+index+')">Delete</button>';
          tableHTML += '</td>';
        } else {
          tableHTML += '<td><button onclick="editRecord(\''+currentSection+'\','+index+')">Edit</button> ';
          tableHTML += '<button onclick="exportRecordCSV(\''+currentSection+'\','+index+')">Export CSV</button> ';
          tableHTML += '<button onclick="deleteRecord(\''+currentSection+'\','+index+')">Delete</button></td>';
        }
        tableHTML += '</tr>';
      });
      tableHTML += '</tbody></table>';
      document.getElementById('recordsTableContainer').innerHTML = tableHTML;
    }

    // New function to render dashboard buttons filtered by a search string
    let dashboardViewMode = "list";
    function renderDashboardSections(filterText) {
      const container = document.getElementById('bigButtonsContainer');
      container.innerHTML = "";
      filterText = filterText || "";
      if(dashboardViewMode === "table") {
        let html = '<table class="records-table"><thead><tr><th>Section</th><th>Action</th></tr></thead><tbody>';
        for (let key in sections) {
          let displayName = sections[key].displayName;
          if (!filterText || displayName.toLowerCase().includes(filterText.toLowerCase())) {
            html += '<tr><td>' + displayName + '</td><td><button onclick="showSection(\''+key+'\')">Open</button></td></tr>';
          }
        }
        html += '</tbody></table>';
        container.innerHTML = html;
      } else if(dashboardViewMode === "list") {
        let html = '<ol class="dashboard-list">';
        for (let key in sections) {
          let displayName = sections[key].displayName;
          if (!filterText || displayName.toLowerCase().includes(filterText.toLowerCase())) {
            let blurb = sectionBlurbs[key] || "This section enhances the overall QMS.";
            html += '<li style="width:500%;">' +
                    '<a href="javascript:void(0)" onclick="showSection(\'' + key + '\')" style="color: inherit; text-decoration: none; font-weight: bold;">' + displayName + '</a>' +
                    '<br/><span style="font-size: 12px; color: #ccc;">' + blurb + '</span>' +
                    '</li>';
          }
        }
        html += '</ol>';
        container.innerHTML = html;
      } else {
        const grid = document.createElement('div');
        grid.style.display = 'grid';
        grid.style.gridTemplateColumns = 'repeat(8, 1fr)';
        grid.style.gap = '20px';
        for (let key in sections) {
          let displayName = sections[key].displayName;
          if (!filterText || displayName.toLowerCase().includes(filterText.toLowerCase())) {
            const btn = document.createElement('button');
            if (dashboardViewMode === "current") {
              btn.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px; margin-bottom: 10px;"><rect x="4" y="4" width="16" height="16"/></svg><span>${displayName}</span>`;
              btn.addEventListener('mouseover', function() {
                btn.style.transform = 'scale(1.05)';
                btn.style.boxShadow = '6px 6px 12px rgba(0,0,0,0.4), -6px -6px 12px rgba(255,255,255,0.15)';
              });
              btn.addEventListener('mouseout', function() {
                btn.style.transform = 'scale(1)';
                btn.style.boxShadow = '4px 4px 8px rgba(0,0,0,0.3), -4px -4px 8px rgba(255,255,255,0.1)';
              });
            } else if (dashboardViewMode === "smallIcon") {
              btn.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor" style="width:16px;height:16px; margin-bottom: 5px;"><rect x="4" y="4" width="16" height="16"/></svg><span style="font-size:12px;">${displayName}</span>`;
            } else if (dashboardViewMode === "iconTooltip") {
              btn.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;"></svg>`;
              btn.title = displayName;
            } else if (dashboardViewMode === "smallIconTooltip") {
              btn.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor" style="width:16px;height:16px;"></svg>`;
              btn.title = displayName;
            }
            btn.onclick = () => {
              showSection(key);
            };
            grid.appendChild(btn);
          }
        }
        container.appendChild(grid);
      }
    }
    
    // Attach event listener for the new dashboard view option selector.
    document.querySelectorAll('.view-option-btn').forEach(button => {
      button.addEventListener('click', function() {
        dashboardViewMode = this.getAttribute('data-mode');
        document.querySelectorAll('.view-option-btn').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        renderDashboardSections(searchInput.value || "");
      });
    });

    // Modify the initDashboard function to use the new renderDashboardSections function.
    function initDashboard() {
      renderDashboardSections("");
    }
    
    // Update search functionality to use renderDashboardSections instead of renderDashboardButtons.
    const searchBtn = document.getElementById('searchBtn');
    const searchInput = document.getElementById('searchInput');
    searchBtn.addEventListener('click', function() {
      if (searchInput.style.display === "none" || searchInput.style.display === "") {
        searchInput.style.display = "inline-block";
        searchInput.focus();
      } else {
        searchInput.style.display = "none";
        searchInput.value = "";
        renderDashboardSections("");
      }
    });
    searchInput.addEventListener('input', function() {
      const dashboardView = document.getElementById('dashboardView');
      const sectionView = document.getElementById('sectionView');
      if (dashboardView.style.display !== "none") {
        renderDashboardSections(this.value || "");
      } else if (sectionView.style.display !== "none") {
        renderRecordsTable();
      }
    });

    // Event listener for Back button in section view
    document.getElementById('backToDashboard').addEventListener('click', renderDashboard);

    // Event listener for New button in section view
    document.getElementById('newRecordBtn').addEventListener('click', function() {
      openModal(currentSection);
    });

    // Add new functions to handle the extra actions for MyAML-Manufacturers
    function detailsRecord(sectionKey, recordIndex) {
      alert("Details for record " + recordIndex + " in section " + sectionKey);
    }
    function materialsRecord(sectionKey, recordIndex) {
      alert("Materials for record " + recordIndex + " in section " + sectionKey);
    }
    function attachmentsRecord(sectionKey, recordIndex) {
      alert("Attachments for record " + recordIndex + " in section " + sectionKey);
    }
    function historyRecord(sectionKey, recordIndex) {
      alert("History for record " + recordIndex + " in section " + sectionKey);
    }

    // New function to view manufacturer details from Manage Approvals
    function viewManufacturerApproval(sectionKey, recordIndex) {
      const record = dataStore[sectionKey][recordIndex];
      alert("Manufacturer Details:\nCompany: " + record["Company"] +
            "\nFacility: " + record["Facility Name"] +
            "\nBrand: " + record["Brand Name(s)"] +
            "\nCountry: " + record["Country"]);
    }

    // New function to update Approval Status for MyAML records based on Manage Approvals changes
    function updateApprovalStatusForMyAML(approvalRecord) {
      if (!dataStore["myAML"]) return;
      dataStore["myAML"].forEach(function(record) {
        if(record["Company"] === approvalRecord["Company"] &&
           record["Brand"] === approvalRecord["Brand Name(s)"] &&
           record["Facility"] === approvalRecord["Facility Name"] &&
           record["Country"] === approvalRecord["Country"]) {
             record["Status"] = approvalRecord["Approval Level"];
        }
      });
    }

    // Function to close modal
    function closeModal() {
      document.getElementById('modal').style.display = "none";
    }

    // Function to edit a record
    function editRecord(sectionKey, recordIndex) {
      openModal(sectionKey, recordIndex);
    }

    // Function to delete a record
    function deleteRecord(sectionKey, recordIndex) {
      if(confirm('Are you sure you want to delete this record?')) {
        let deletedRecord;
        if (sectionKey === "purchases") {
          let subKey = getPurchasesSubKey();
          deletedRecord = Object.assign({}, dataStore[subKey][recordIndex]);
          logHistory(sectionKey, "Delete", Object.keys(deletedRecord), deletedRecord, {});
          dataStore[subKey].splice(recordIndex, 1);
        } else if (sectionKey === "sales") {
          let subKey = getSalesSubKey();
          deletedRecord = Object.assign({}, dataStore[subKey][recordIndex]);
          logHistory(sectionKey, "Delete", Object.keys(deletedRecord), deletedRecord, {});
          dataStore[subKey].splice(recordIndex, 1);
        } else if (sectionKey === "inventory") {  
          let subKey = getInventorySubKey();
          deletedRecord = Object.assign({}, dataStore[subKey][recordIndex]);
          logHistory(sectionKey, "Delete", Object.keys(deletedRecord), deletedRecord, {});
          dataStore[subKey].splice(recordIndex, 1);
        } else if (sectionKey === "qcInventory") {  
          let subKey = getQCInventorySubKey();
          deletedRecord = Object.assign({}, dataStore[subKey][recordIndex]);
          logHistory(sectionKey, "Delete", Object.keys(deletedRecord), deletedRecord, {});
          dataStore[subKey].splice(recordIndex, 1);
        } else {
          deletedRecord = Object.assign({}, dataStore[sectionKey][recordIndex]);
          logHistory(sectionKey, "Delete", Object.keys(deletedRecord), deletedRecord, {});
          dataStore[sectionKey].splice(recordIndex, 1);
        }
        renderRecordsTable();
      }
    }

    // --- NEW Global Notifications Variable ---
    var notifications = [];

    // --- NEW Function to update the notifications badge ---
    function updateNotificationBadge() {
      const badge = document.getElementById('notificationBadge');
      const unread = notifications.filter(n => !n.read).length;
      if (unread > 0) {
        badge.style.display = 'inline-block';
        badge.textContent = unread;
      } else {
        badge.style.display = 'none';
      }
    }

    // --- Modify the logHistory function to create a notification ---
    function logHistory(table, action, changedFields, oldValues, newValues) {
      const historyEntry = {
        "Table": table,
        "Action": action,
        "Action Date": new Date().toISOString(),
        "User": currentUser.username,  // updated to use the username property
        "Fields Changed": changedFields.length ? changedFields.join(", ") : "",
        "Old Values": Object.keys(oldValues).length ? JSON.stringify(oldValues) : "",
        "New Values": Object.keys(newValues).length ? JSON.stringify(newValues) : ""
      };
      dataStore["history"].push(historyEntry);
      if (currentSection === "history") {
        renderRecordsTable();
      }
      // --- NEW: Log a notification for this change ---
      let notif = {
        section: table,
        action: action,
        timestamp: new Date().toISOString(),
        details: changedFields.length ? "Fields changed: " + changedFields.join(", ") : "",
        read: false
      };
      notifications.push(notif);
      updateNotificationBadge();
    }

    // --- NEW Function to open Notifications Modal ---
    function openNotificationsModal() {
      const modal = document.getElementById('notificationsModal');
      let modalHTML = '<div class="modal">';
      modalHTML += '<h2>Notifications</h2>';
      if (notifications.length === 0) {
        modalHTML += '<p>No notifications.</p>';
      } else {
        modalHTML += '<ul>';
        notifications.forEach((notif, index) => {
          modalHTML += '<li style="margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;">' +
                     '<strong>Section:</strong> ' + notif.section + '<br>' +
                     '<strong>Action:</strong> ' + notif.action + '<br>' +
                     '<strong>Time:</strong> ' + notif.timestamp + '<br>' +
                     (notif.details ? ('<strong>Details:</strong> ' + notif.details + '<br>') : '') +
                     '</li>';
        });
        modalHTML += '</ul>';
      }
      modalHTML += '<div style="text-align: right; margin-top: 10px;"><button onclick="closeNotificationsModal()">Close</button></div>';
      modalHTML += '</div>';
      modal.innerHTML = modalHTML;
      modal.style.display = "flex";
    }

    // --- NEW Function to close Notifications Modal and mark all as read ---
    function closeNotificationsModal() {
      notifications.forEach(n => n.read = true);
      updateNotificationBadge();
      document.getElementById('notificationsModal').style.display = "none";
    }

    // --- Attach event listener to the Notifications (bell) button ---
    document.getElementById('notificationsBtn').addEventListener('click', openNotificationsModal);

    // Add event listener for Home button if not already attached
    document.getElementById('homeBtn').addEventListener('click', showHome);

    // Initialize dashboard on page load
    initDashboard();

    // NEW Export CSV Functions
    function openModal(section, recordIndex) {
      const modal = document.getElementById('modal');
      let record = {};
      const isEdit = (recordIndex !== undefined);
      if (isEdit) {
        record = (dataStore[section] && dataStore[section][recordIndex]) ? dataStore[section][recordIndex] : {};
      }
      const fields = (sections[section] && sections[section].fields) ? sections[section].fields : [];
      let html = '<div class="modal-content" style="background:#222; padding:20px; border-radius:8px; width:90%; max-width:600px;">';
      html += '<h2>' + (isEdit ? 'Edit' : 'New') + ' Record for ' + sections[section].displayName + '</h2>';
      html += '<form id="recordForm">';
      fields.forEach(field => {
        const value = (isEdit && record[field]) ? record[field] : '';
        html += '<label>' + field + ':</label>';
        html += '<input type="text" name="' + field + '" value="' + value + '" style="width:100%; padding:5px; margin-bottom:10px; background:#333; border:1px solid #555; color:#fff;">';
      });
      html += '<div style="text-align: right;">';
      html += '<button type="button" onclick="submitRecordForm(\'' + section + '\',' + (isEdit ? recordIndex : 'undefined') + ')" style="padding: 5px 10px; margin-right:10px; background:#444; border:none; color:#fff; border-radius:4px;">Save</button>';
      html += '<button type="button" onclick="closeModal()" style="padding: 5px 10px; background:#444; border:none; color:#fff; border-radius:4px;">Cancel</button>';
      html += '</div>';
      html += '</form>';
      html += '</div>';
      
      modal.innerHTML = html;
      modal.style.display = "flex";
    }

    function submitRecordForm(section, recordIndex) {
      const form = document.getElementById('recordForm');
      const formData = new FormData(form);
      let newRecord = {};
      const fields = (sections[section] && sections[section].fields) ? sections[section].fields : [];
      fields.forEach(field => {
        newRecord[field] = formData.get(field);
      });
      if (recordIndex !== undefined && recordIndex !== "undefined") {
        let oldRecord = dataStore[section][recordIndex];
        let changedFields = [];
        fields.forEach(field => {
          if (newRecord[field] !== oldRecord[field]) { changedFields.push(field); }
        });
        logHistory(section, "Edit", changedFields, oldRecord, newRecord);
        dataStore[section][recordIndex] = newRecord;
      } else {
        if (!dataStore[section]) {
          dataStore[section] = [];
        }
        logHistory(section, "Add", fields, {}, newRecord);
        dataStore[section].push(newRecord);
      }
      closeModal();
      renderRecordsTable();
    }
    function openExportModal() {
      const exportModal = document.getElementById('exportModal');
      let modalHTML = '<div class="modal">';
      modalHTML += '<h2>Export to CSV</h2>';
      modalHTML += '<label for="exportDropdown">Choose a section:</label>';
      modalHTML += '<select id="exportDropdown">';
      modalHTML += '<option value="" disabled selected>Select a section</option>';  
      for (const key in sections) {
        modalHTML += '<option value="' + key + '">' + sections[key].displayName + '</option>';
      }
      modalHTML += '</select><br/><br/>';
      modalHTML += '<button id="downloadCsvBtn">Download CSV</button> ';
      modalHTML += '<button id="cancelExportBtn">Cancel</button>';
      modalHTML += '</div>';
      exportModal.innerHTML = modalHTML;
      exportModal.style.display = "flex";

      document.getElementById('cancelExportBtn').addEventListener('click', closeExportModal);
      document.getElementById('downloadCsvBtn').addEventListener('click', downloadCSV);
    }

    function closeExportModal() {
      document.getElementById('exportModal').style.display = "none";
    }

    function downloadCSV() {
      const dropdown = document.getElementById('exportDropdown');
      const selectedSection = dropdown.value;
      if (!selectedSection) {
        alert("Please select a section to export.");
        return;
      }
      if (selectedSection === "all") {
        let csvContent = "";
        for (const key in sections) {
          const records = dataStore[key] || [];
          if (records.length > 0) {
            const fields = sections[key].fields;
            csvContent += 'Section: ' + sections[key].displayName + '\n';
            csvContent += fields.join(',') + '\n';
            records.forEach(record => {
              let row = fields.map(field => {
                let val = record[field] || '';
                val = '"' + val.toString().replace(/"/g, '""') + '"';
                return val;
              }).join(',');
              csvContent += row + '\n';
            });
            csvContent += '\n';
          }
        }
        if (!csvContent) {
          alert("No records found to export.");
          return;
        }
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'all_sections.csv';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        closeExportModal();
        return;
      }
      const records = dataStore[selectedSection] || [];
      const fields = sections[selectedSection].fields;
      let csvContent = fields.join(',') + '\n';
      records.forEach(record => {
        let row = fields.map(field => {
          let val = record[field] || '';
          val = '"' + val.toString().replace(/"/g, '""') + '"';
          return val;
        }).join(',');
        csvContent += row + '\n';
      });
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = selectedSection + '.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      closeExportModal();
    }

    // Attach event listener to Export CSV button
    document.getElementById('exportBtn').addEventListener('click', openExportModal);

    // Favorites management functionality
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    function saveFavoritesToStorage() {
      localStorage.setItem('favorites', JSON.stringify(favorites));
    }
    function renderFavoritesDropdown() {
      const dropdown = document.getElementById('favoritesDropdown');
      dropdown.innerHTML = "";
      if (favorites.length === 0) {
        dropdown.innerHTML = "<div style='padding: 5px;'>No favorites added.</div>";
      } else {
        favorites.forEach((fav, index) => {
          const item = document.createElement('div');
          item.className = "favorite-item";
          
          // Favorite name (click to navigate)
          const nameSpan = document.createElement('span');
          nameSpan.className = "favorite-name";
          nameSpan.textContent = fav.name;
          nameSpan.onclick = () => {
            showSection(fav.sectionKey);
            toggleFavoritesDropdown(false);
          };
          item.appendChild(nameSpan);
          
          // Actions container: Edit and Delete buttons
          const actionsDiv = document.createElement('div');
          actionsDiv.className = "favorite-actions";
          
          // Edit button (rename)
          const editBtn = document.createElement('button');
          editBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor" style="width:16px; height:16px;"><path d="M3 17.25L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>';
          editBtn.onclick = (e) => {
            e.stopPropagation();
            const newName = prompt("Edit Favorite Name:", fav.name);
            if(newName === null) return;
            const newFav = {
              sectionKey: fav.sectionKey,
              name: newName.trim() || fav.name
            };
            favorites[index] = newFav;
            saveFavoritesToStorage();
            renderFavoritesDropdown();
          };
          actionsDiv.appendChild(editBtn);
          
          // Delete button
          const deleteBtn = document.createElement('button');
          deleteBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor" style="width:16px; height:16px;"><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-4.5l-1-1z"/></svg>';
          deleteBtn.onclick = (e) => {
            e.stopPropagation();
            if (confirm("Delete this favorite?")) {
              favorites.splice(index, 1);
              saveFavoritesToStorage();
              renderFavoritesDropdown();
            }
          };
          actionsDiv.appendChild(deleteBtn);
          
          item.appendChild(actionsDiv);
          dropdown.appendChild(item);
        });
      }
    }
    function toggleFavoritesDropdown(forceShow) {
      const dropdown = document.getElementById('favoritesDropdown');
      if (forceShow === true) {
        dropdown.style.display = "block";
      } else if (forceShow === false) {
        dropdown.style.display = "none";
      } else {
        dropdown.style.display = (dropdown.style.display === "none" || dropdown.style.display === "") ? "block" : "none";
      }
    }
    // When the favorites (star) button is clicked, add the current section as favorite if not already added and toggle the dropdown.
    document.getElementById('favoritesBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      if (currentSection) {
        let exists = favorites.find(fav => fav.sectionKey === currentSection);
        if (!exists) {
          let fav = { sectionKey: currentSection, name: sections[currentSection].displayName };
          favorites.push(fav);
          saveFavoritesToStorage();
        }
      }
      renderFavoritesDropdown();
      toggleFavoritesDropdown();
    });
    // Close the favorites dropdown if the user clicks outside of it.
    document.addEventListener('click', function(event) {
      const favDropdown = document.getElementById('favoritesDropdown');
      const favBtn = document.getElementById('favoritesBtn');
      if (!favDropdown.contains(event.target) && !favBtn.contains(event.target)) {
        favDropdown.style.display = "none";
      }
      const docDropdown = document.getElementById('documentsDropdown');
      const docBtn = document.getElementById('documentsBtn');
      if (docDropdown && docBtn && !docDropdown.contains(event.target) && !docBtn.contains(event.target)) {
        docDropdown.style.display = "none";
      }
    });

    // Checklist Creator Section functionality
    function renderChecklistCreator() {
      const container = document.getElementById('recordsTableContainer');
      container.innerHTML = `
        <div id="checklistForm">
          <h3>Create Checklist</h3>
          <label>Checklist Title: </label>
          <input type="text" id="checklistTitle" placeholder="Enter checklist title"/><br/><br/>
          <label>Checklist Items:</label>
          <div id="checklistItemsContainer"></div>
          <button id="addChecklistItemBtn">Add Item</button>
          <br/><br/>
          <button id="saveChecklistBtn">Save Checklist</button>
        </div>
        <hr/>
        <div id="checklistList">
          <h3>Existing Checklists</h3>
          <div id="existingChecklists"></div>
        </div>
      `;

      const checklistItemsContainer = document.getElementById("checklistItemsContainer");

      document.getElementById("addChecklistItemBtn").addEventListener("click", function() {
        const newItemDiv = document.createElement("div");
        newItemDiv.classList.add("checklist-item");
        
        // Checklist item input
        const itemInput = document.createElement("input");
        itemInput.type = "text";
        itemInput.classList.add("checklist-item-input");
        itemInput.placeholder = "Enter item text";
        newItemDiv.appendChild(itemInput);

        // Remove button
        const removeBtn = document.createElement("button");
        removeBtn.textContent = "Remove";
        removeBtn.onclick = function() {
          checklistItemsContainer.removeChild(newItemDiv);
        };
        newItemDiv.appendChild(removeBtn);

        checklistItemsContainer.appendChild(newItemDiv);
      });

      document.getElementById("saveChecklistBtn").addEventListener("click", function() {
        const title = document.getElementById("checklistTitle").value.trim();
        if (!title) {
          alert("Please enter a checklist title");
          return;
        }
        const itemInputs = document.querySelectorAll(".checklist-item-input");
        let items = [];
        itemInputs.forEach(input => {
          let val = input.value.trim();
          if(val) {
            items.push(val);
          }
        });
        if (items.length === 0) {
          alert("Please add at least one checklist item");
          return;
        }
        const newChecklist = {
          "Checklist Title": title,
          "Items": items.join(" | "),
          "Created Date": new Date().toLocaleString(),
          "Status": "New"
        };

        if (!dataStore["checklistCreator"]) {
          dataStore["checklistCreator"] = [];
        }
        dataStore["checklistCreator"].push(newChecklist);
        logHistory("checklistCreator", "Add", ["Checklist Title", "Items"], {}, newChecklist);
        document.getElementById("checklistTitle").value = "";
        checklistItemsContainer.innerHTML = "";
        renderExistingChecklists();
      });

      function renderExistingChecklists() {
        const listContainer = document.getElementById("existingChecklists");
        const checklists = dataStore["checklistCreator"] || [];
        if(checklists.length === 0) {
          listContainer.innerHTML = "<p>No checklists created yet.</p>";
          return;
        }
        let html = "<table class='records-table'><thead><tr>";
        const fields = sections["checklistCreator"].fields;
        fields.forEach(field => {
          html += `<th>${field}</th>`;
        });
        html += "<th>Actions</th></tr></thead><tbody>";
        checklists.forEach((cl, index) => {
          html += "<tr>";
          fields.forEach(field => {
            html += `<td>${cl[field] || ""}</td>`;
          });
          html += `<td><button onclick="editChecklist(${index})">Edit</button> <button onclick="deleteChecklist(${index})">Delete</button></td>`;
          html += "</tr>";
        });
        html += "</tbody></table>";
        listContainer.innerHTML = html;
      }
      renderExistingChecklists();
    }

    function editChecklist(index) {
      const checklist = dataStore["checklistCreator"][index];
      const newTitle = prompt("Edit Checklist Title:", checklist["Checklist Title"]);
      if(newTitle === null) return;
      const newItems = prompt("Edit Checklist Items (separate items with |):", checklist["Items"]);
      if(newItems === null) return;
      const updatedChecklist = {
        "Checklist Title": newTitle.trim(),
        "Items": newItems.trim(),
        "Created Date": checklist["Created Date"],
        "Status": checklist["Status"]
      };

      logHistory("checklistCreator", "Edit", ["Checklist Title", "Items"], checklist, updatedChecklist);
      dataStore["checklistCreator"][index] = updatedChecklist;
      renderChecklistCreator();
    }

    function deleteChecklist(index) {
      if (confirm("Are you sure you want to delete this checklist?")) {
        const checklist = dataStore["checklistCreator"][index];
        logHistory("checklistCreator", "Delete", Object.keys(checklist), checklist, {});
        dataStore["checklistCreator"].splice(index, 1);
        renderChecklistCreator();
      }
    }

    // New function to render the Work Instruction Creator Section
    function renderWorkInstructionCreator() {
      const container = document.getElementById('recordsTableContainer');
      container.innerHTML = `
        <div id="wiForm">
          <h3>Create Work Instruction</h3>
          <label>Title:</label>
          <input type="text" id="wiTitle" placeholder="Enter title"/><br/><br/>
          <label>Description:</label>
          <textarea id="wiDescription" placeholder="Enter description" rows="3" style="width:100%;"></textarea><br/><br/>
          <label>Steps:</label>
          <div id="wiStepsContainer"></div>
          <button id="addWiStepBtn">Add Step</button>
          <br/><br/>
          <label>Tools Required:</label>
          <input type="text" id="wiTools" placeholder="Enter tools, separated by commas"/><br/><br/>
          <label>Safety Precautions:</label>
          <textarea id="wiSafety" placeholder="Enter safety precautions" rows="2" style="width:100%;"></textarea><br/><br/>
          <button id="saveWiBtn">Save Work Instruction</button>
        </div>
        <hr/>
        <div id="wiList">
          <h3>Existing Work Instructions</h3>
          <div id="existingWi"></div>
        </div>
      `;

      // Event listener for Add Step button
      const stepsContainer = document.getElementById("wiStepsContainer");
      document.getElementById("addWiStepBtn").addEventListener("click", function() {
        const stepDiv = document.createElement("div");
        stepDiv.classList.add("wi-step");
        
        // Checklist item input
        const stepInput = document.createElement("input");
        stepInput.type = "text";
        stepInput.classList.add("wi-step-input");
        stepInput.placeholder = "Enter step";
        stepDiv.appendChild(stepInput);
        
        // Remove button
        const removeStepBtn = document.createElement("button");
        removeStepBtn.textContent = "Remove";
        removeStepBtn.onclick = function() {
          stepsContainer.removeChild(stepDiv);
        };
        stepDiv.appendChild(removeStepBtn);
        
        stepsContainer.appendChild(stepDiv);
      });

      // Event listener for Save Work Instruction button
      document.getElementById("saveWiBtn").addEventListener("click", function() {
        const title = document.getElementById("wiTitle").value.trim();
        const description = document.getElementById("wiDescription").value.trim();
        let steps = [];
        document.querySelectorAll(".wi-step-input").forEach(input => {
          let val = input.value.trim();
          if(val) { steps.push(val); }
        });
        const tools = document.getElementById("wiTools").value.trim();
        const safety = document.getElementById("wiSafety").value.trim();

        if (!title) {
          alert("Please enter a title.");
          return;
        }
        if (steps.length === 0) {
          alert("Please add at least one step.");
          return;
        }

        const newWi = {
          "Title": title,
          "Description": description,
          "Steps": steps.join(" | "),
          "Tools Required": tools,
          "Safety Precautions": safety,
          "Created Date": new Date().toLocaleString(),
          "Status": "New"
        };

        if (!dataStore["workInstructionCreator"]) {
          dataStore["workInstructionCreator"] = [];
        }
        dataStore["workInstructionCreator"].push(newWi);
        logHistory("workInstructionCreator", "Add", ["Title", "Description", "Steps", "Tools Required", "Safety Precautions"], {}, newWi);
        clearWiForm();
        renderExistingWi();
      });

      function clearWiForm() {
        document.getElementById("wiTitle").value = "";
        document.getElementById("wiDescription").value = "";
        document.getElementById("wiTools").value = "";
        document.getElementById("wiSafety").value = "";
        document.getElementById("wiStepsContainer").innerHTML = "";
      }

      function renderExistingWi() {
        const container = document.getElementById("existingWi");
        const wiList = dataStore["workInstructionCreator"] || [];
        if(wiList.length === 0) {
          container.innerHTML = "<p>No work instructions created yet.</p>";
          return;
        }
        let html = "<table class='records-table'><thead><tr>";
        const fields = sections["workInstructionCreator"].fields;
        fields.forEach(field => {
          html += `<th>${field}</th>`;
        });
        html += "<th>Actions</th></tr></thead><tbody>";
        wiList.forEach((wi, index) => {
          html += "<tr>";
          fields.forEach(field => {
            html += `<td>${wi[field] || ""}</td>`;
          });
          html += `<td><button onclick="editWi(${index})">Edit</button> <button onclick="deleteWi(${index})">Delete</button></td>`;
          html += "</tr>";
        });
        html += "</tbody></table>";
        container.innerHTML = html;
      }
      renderExistingWi();
    }

    // New global functions to edit and delete Work Instruction records
    function editWi(index) {
      const wi = dataStore["workInstructionCreator"][index];
      const newTitle = prompt("Edit Title:", wi["Title"]);
      if(newTitle === null) return;
      const newDescription = prompt("Edit Description:", wi["Description"]);
      if(newDescription === null) return;
      const newSteps = prompt("Edit Steps (separate steps with |):", wi["Steps"]);
      if(newSteps === null) return;
      const newTools = prompt("Edit Tools Required:", wi["Tools Required"]);
      if(newTools === null) return;
      const newSafety = prompt("Edit Safety Precautions:", wi["Safety Precautions"]);
      if(newSafety === null) return;

      const updatedWi = {
        "Title": newTitle.trim(),
        "Description": newDescription.trim(),
        "Steps": newSteps.trim(),
        "Tools Required": newTools.trim(),
        "Safety Precautions": newSafety.trim(),
        "Created Date": wi["Created Date"],
        "Status": wi["Status"]
      };

      logHistory("workInstructionCreator", "Edit", ["Title", "Description", "Steps", "Tools Required", "Safety Precautions"], wi, updatedWi);
      dataStore["workInstructionCreator"][index] = updatedWi;
      renderWorkInstructionCreator();
    }

    function deleteWi(index) {
      if(confirm("Are you sure you want to delete this work instruction?")) {
        const wi = dataStore["workInstructionCreator"][index];
        logHistory("workInstructionCreator", "Delete", Object.keys(wi), wi, {});
        dataStore["workInstructionCreator"].splice(index, 1);
        renderWorkInstructionCreator();
      }
    }

    // Add a test record for PDCA
    dataStore["pdca"] = [{
      "Plan": "Identify improvement areas in production",
      "Do": "Implement process adjustments",
      "Check": "Monitor production metrics",
      "Act": "Standardize successful changes",
      "Review Date": "2023-11-15",
      "Status": "Ongoing",
      "Comments": "First PDCA cycle initiated"
    }];

    // NEW Export Record CSV Function
    function exportRecordCSV(sectionKey, recordIndex) {
      const record = dataStore[sectionKey][recordIndex];
      const fields = sections[sectionKey].fields;
      let csvContent = fields.join(',') + '\n';
      let row = fields.map(field => {
        let val = record[field] || '';
        val = '"' + val.toString().replace(/"/g, '""') + '"';
        return val;
      }).join(',');
      csvContent += row;
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = sections[sectionKey].displayName + '_record_' + recordIndex + '.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // NEW Function to render the Theme Manager interface
    function renderThemeManager() {
      const container = document.getElementById('recordsTableContainer');
      container.innerHTML = `
        <div id="themeManager" style="padding:20px;">
          <h3>Theme Manager</h3>
          <form id="themeForm">
            <div style="margin-bottom: 10px;">
              <label for="primaryColor">Primary Color:</label>
              <input type="color" id="primaryColor" name="primaryColor" value="#0a101a"/>
            </div>
            <div style="margin-bottom: 10px;">
              <label for="secondaryColor">Secondary Color:</label>
              <input type="color" id="secondaryColor" name="secondaryColor" value="#263147"/>
            </div>
            <div style="margin-bottom: 10px;">
              <label for="fontFamily">Font Family:</label>
              <select id="fontFamily" name="fontFamily">
                <option value="Arial, sans-serif">Arial</option>
                <option value="Helvetica, sans-serif">Helvetica</option>
                <option value="'Times New Roman', Times, serif">Times New Roman</option>
                <option value="'Courier New', Courier, monospace">Courier New</option>
              </select>
            </div>
            <div style="margin-bottom: 10px;">
              <label for="fontSize">Base Font Size (px):</label>
              <input type="number" id="fontSize" name="fontSize" value="16" min="10" max="36"/>
            </div>
            <button type="submit">Apply Theme</button>
          </form>
        </div>
      `;
      
      document.getElementById("themeForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const primaryColor = document.getElementById("primaryColor").value;
        const secondaryColor = document.getElementById("secondaryColor").value;
        const fontFamily = document.getElementById("fontFamily").value;
        const fontSize = document.getElementById("fontSize").value;
        
        // Apply theme to document body
        document.body.style.fontFamily = fontFamily;
        document.body.style.fontSize = fontSize + "px";
        document.body.style.background = `linear-gradient(135deg, ${primaryColor}, ${secondaryColor})`;
        
        // Save theme settings to localStorage for persistence
        localStorage.setItem("themeSettings", JSON.stringify({
          primaryColor: primaryColor,
          secondaryColor: secondaryColor,
          fontFamily: fontFamily,
          fontSize: fontSize
        }));
        
        alert("Theme applied successfully!");
      });
    }

    // NEW Function to apply stored theme settings on page load
    function applyStoredTheme() {
      const theme = JSON.parse(localStorage.getItem("themeSettings"));
      if (theme) {
        document.body.style.fontFamily = theme.fontFamily;
        document.body.style.fontSize = theme.fontSize + "px";
        document.body.style.background = `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})`;
      }
    }

    // Call applyStoredTheme() after initializing the dashboard
    initDashboard();
    applyStoredTheme();

    // Immediately hide the admin button if the current user is not an Admin
    if (currentUser.role !== "Admin") {
      document.getElementById('adminBtn').style.display = "none";
    }

    // NEW: Show Admin Interface view
    function showAdminInterface() {
      document.getElementById('homeView').style.display = "none";
      document.getElementById('dashboardView').style.display = "none";
      document.getElementById('sectionView').style.display = "none";
      document.getElementById('adminView').style.display = "";
      renderAdminInterface();
    }

    // NEW: Render Admin Interface for managing user roles
    function renderAdminInterface() {
      const adminDiv = document.getElementById('adminView');
      let html = '<div class="section-header">';
      html += '<button id="backFromAdmin" aria-label="Back">';
      html += '<svg viewBox="0 0 24 24" fill="currentColor" style="width:24px;height:24px;">';
      html += '<path d="M15 18l-6-6 6-6"/></svg>';
      html += '</button>';
      html += '<h2>Admin Interface: User Role Management</h2>';
      html += '</div>';
      // NEW: Add User Button
      html += '<div style="margin: 10px 0;">';
      html += '<button onclick="addUser()">Add User</button>';
      html += '</div>';
      html += '<div id="adminContent">';
      html += '<table class="records-table"><thead><tr>';
      html += '<th>User Name</th><th>Email</th><th>Role</th><th>Actions</th>';
      html += '</tr></thead><tbody>';
      dataStore["userDirectory"].forEach((user, index) => {
        let role = user.role || "Auditor";
        html += '<tr>';
        html += '<td>' + user["User Name"] + '</td>';
        html += '<td>' + user["Email"] + '</td>';
        html += '<td>';
        html += '<select onchange="updateUserRole(' + index + ', this.value)">';
        html += '<option value="Admin"' + (role === "Admin" ? " selected" : "") + '>Admin</option>';
        html += '<option value="Auditor"' + (role === "Auditor" ? " selected" : "") + '>Auditor</option>';
        html += '</select>';
        html += '</td>';
        html += '<td>';
        html += '<button onclick="saveUserRole(' + index + ')">Save</button> ';
        html += '<button onclick="editUser(' + index + ')">Edit</button> ';
        html += '<button onclick="deleteUser(' + index + ')">Delete</button>';
        html += '</td>';
        html += '</tr>';
      });
      html += '</tbody></table></div>';
      
      // Set the updated HTML into the adminView container
      adminDiv.innerHTML = html;
      
      // Attach back button listener to return to the Dashboard
      document.getElementById('backFromAdmin').addEventListener('click', function() {
        document.getElementById('adminView').style.display = "none";
        renderDashboard();
      });
    }

    // NEW: Update the temporary role for a user when the select value changes
    function updateUserRole(index, role) {
      dataStore["userDirectory"][index].newRole = role;
    }

    // NEW: Save the updated role for a user and log the change
    function saveUserRole(index) {
      let user = dataStore["userDirectory"][index];
      if (user.newRole && user.newRole !== user.role) {
        logHistory("userDirectory", "Update Role", ["Role"], { Role: user.role }, { Role: user.newRole });
        user.role = user.newRole;
        alert("Role updated to " + user.role);
      } else {
        alert("No change detected.");
      }
    }

    // Attach event listener to the Admin button
    document.getElementById('adminBtn').addEventListener('click', showAdminInterface);

    // NEW: Function to add a new user
    function addUser() {
      const name = prompt("Enter new user's name:");
      if (!name) {
        alert("User name is required.");
        return;
      }
      const email = prompt("Enter new user's email:");
      if (!email) {
        alert("User email is required.");
        return;
      }
      const roleInput = prompt("Enter user role (Admin or Auditor):", "Auditor");
      const newRole = (roleInput && roleInput.toLowerCase() === "admin") ? "Admin" : "Auditor";
      const newUser = {
        "User Name": name.trim(),
        "Email": email.trim(),
        role: newRole
      };
      dataStore["userDirectory"].push(newUser);
      renderAdminInterface();
    }

    // NEW: Function to edit an existing user
    function editUser(index) {
      let user = dataStore["userDirectory"][index];
      const newName = prompt("Edit user's name:", user["User Name"]);
      if (newName === null) return;
      const newEmail = prompt("Edit user's email:", user["Email"]);
      if (newEmail === null) return;
      const updatedUser = {
        "User Name": newName.trim(),
        "Email": newEmail.trim(),
        role: user.role // retain current role value from dropdown
      };
      logHistory("userDirectory", "Edit User", ["User Name", "Email"], user, updatedUser);
      dataStore["userDirectory"][index] = updatedUser;
      renderAdminInterface();
    }

    // NEW: Function to delete an existing user
    function deleteUser(index) {
      if (confirm("Are you sure you want to delete this user?")) {
        const user = dataStore["userDirectory"][index];
        logHistory("userDirectory", "Delete User", Object.keys(user), user, {});
        dataStore["userDirectory"].splice(index, 1);
        renderAdminInterface();
      }
    }
    // Attach event listener to the Documents (doc) button
    document.getElementById('documentsBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      toggleDocumentsDropdown();
    });

    function toggleDocumentsDropdown() {
      const dropdown = document.getElementById('documentsDropdown');
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        renderDocumentsDropdown();
        dropdown.style.display = "block";
      }
    }

    function renderDocumentsDropdown() {
      const dropdown = document.getElementById('documentsDropdown');
      const links = [
        { key: "qualityDocuments", name: "Quality Documents Library" },
        { key: "documentRevisionRegister", name: "Document Revision Register" },
        { key: "registerFormRepo", name: "Quality Register and Form Repository" },
        { key: "docRecordControl", name: "Document and Record Control Procedure" },
        { key: "documents", name: "Documents" },
        { key: "checklistCreator", name: "Checklist Creator" },
        { key: "workInstructionCreator", name: "Work Instruction Creator" }
      ];
      let html = "";
      links.forEach(link => {
        html += `<div style="margin-bottom: 5px;">
                   <a href="javascript:void(0)" onclick="selectDocumentsSection('${link.key}')" style="color: #fff; text-decoration: none;">
                     ${link.name}
                   </a>
                 </div>`;
      });
      dropdown.innerHTML = html;
    }

    function selectDocumentsSection(sectionKey) {
      showSection(sectionKey);
      document.getElementById('documentsDropdown').style.display = "none";
    }
    // Extend the document click listener to hide the documents dropdown when clicking outside it
    document.addEventListener('click', function(event) {
      const favDropdown = document.getElementById('favoritesDropdown');
      const favBtn = document.getElementById('favoritesBtn');
      if (!favDropdown.contains(event.target) && !favBtn.contains(event.target)) {
        favDropdown.style.display = "none";
      }
      const docDropdown = document.getElementById('documentsDropdown');
      const docBtn = document.getElementById('documentsBtn');
      if (docDropdown && docBtn && !docDropdown.contains(event.target) && !docBtn.contains(event.target)) {
        docDropdown.style.display = "none";
      }
    });

    // NEW: Audit Dropdown functionality
    document.getElementById('auditBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      toggleAuditDropdown();
    });

    function toggleAuditDropdown() {
      const dropdown = document.getElementById('auditDropdown');
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        renderAuditDropdown();
        dropdown.style.display = "block";
      }
    }

    function renderAuditDropdown() {
      const dropdown = document.getElementById('auditDropdown');
      const links = [
        { key: "internalAudit", name: "Quality Internal Audit" },
        { key: "buildAudit", name: "Build Audit" },
        { key: "auditProgram", name: "Create Audit Program" },
        { key: "externalAudit", name: "Quality External Audit" },
        { key: "auditObject", name: "Audit Object" },
        { key: "audit", name: "Audit" }
      ];
      let html = "";
      links.forEach(link => {
        html += `<div style="margin-bottom: 5px;">
                    <a href="javascript:void(0)" onclick="selectAuditSection('${link.key}')" style="color: #fff; text-decoration: none;">
                      ${link.name}
                    </a>
                  </div>`;
      });
      dropdown.innerHTML = html;
    }

    function selectAuditSection(sectionKey) {
      showSection(sectionKey);
      document.getElementById('auditDropdown').style.display = "none";
    }

    document.addEventListener('click', function(event) {
      const favDropdown = document.getElementById('favoritesDropdown');
      const favBtn = document.getElementById('favoritesBtn');
      if (!favDropdown.contains(event.target) && !favBtn.contains(event.target)) {
        favDropdown.style.display = "none";
      }
      const docDropdown = document.getElementById('documentsDropdown');
      const docBtn = document.getElementById('documentsBtn');
      if (docDropdown && docBtn && !docDropdown.contains(event.target) && !docBtn.contains(event.target)) {
        docDropdown.style.display = "none";
      }
      const auditDropdown = document.getElementById('auditDropdown');
      const auditBtn = document.getElementById('auditBtn');
      if (auditDropdown && auditBtn && !auditDropdown.contains(event.target) && !auditBtn.contains(event.target)) {
        auditDropdown.style.display = "none";
      }
    });

    // NEW Resource Management Dropdown functionality
    document.getElementById('resourceManagementBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      toggleResourceManagementDropdown();
    });

    function toggleResourceManagementDropdown() {
      const dropdown = document.getElementById('resourceManagementDropdown');
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        renderResourceManagementDropdown();
        dropdown.style.display = "block";
      }
    }

    function renderResourceManagementDropdown() {
      const dropdown = document.getElementById('resourceManagementDropdown');
      const links = [
        { key: "training", name: "Training Management" },
        { key: "purchases", name: "Purchases" },
        { key: "sales", name: "Sales" },
        { key: "inventory", name: "Inventory" },
        { key: "qcInventory", name: "QC Inventory" },
        { key: "operations", name: "Operations" },
        { key: "safety", name: "Safety" },
        { key: "operationalPlanning", name: "Operational Planning & Control" }
      ];
      let html = "";
      links.forEach(link => {
        html += `<div style="margin-bottom: 5px;">
                    <a href="javascript:void(0)" onclick="selectResourceManagementSection('${link.key}')" style="color: #fff; text-decoration: none;">
                      ${link.name}
                    </a>
                  </div>`;
      });
      dropdown.innerHTML = html;
    }

    function selectResourceManagementSection(sectionKey) {
      showSection(sectionKey);
      document.getElementById('resourceManagementDropdown').style.display = "none";
    }

    document.addEventListener('click', function(event) {
      const favDropdown = document.getElementById('favoritesDropdown');
      const favBtn = document.getElementById('favoritesBtn');
      if (!favDropdown.contains(event.target) && !favBtn.contains(event.target)) {
        favDropdown.style.display = "none";
      }
      const docDropdown = document.getElementById('documentsDropdown');
      const docBtn = document.getElementById('documentsBtn');
      if (docDropdown && docBtn && !docDropdown.contains(event.target) && !docBtn.contains(event.target)) {
        docDropdown.style.display = "none";
      }
      const auditDropdown = document.getElementById('auditDropdown');
      const auditBtn = document.getElementById('auditBtn');
      if (auditDropdown && auditBtn && !auditDropdown.contains(event.target) && !auditBtn.contains(event.target)) {
        auditDropdown.style.display = "none";
      }
      const rmDropdown = document.getElementById('resourceManagementDropdown');
      const rmBtn = document.getElementById('resourceManagementBtn');
      if (rmDropdown && rmBtn && !rmDropdown.contains(event.target) && !rmBtn.contains(event.target)) {
        rmDropdown.style.display = "none";
      }
    });

    // NEW Approved Supply Dropdown functionality
    document.getElementById('approvedSupplyBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      toggleApprovedSupplyDropdown();
    });

    function toggleApprovedSupplyDropdown() {
      const dropdown = document.getElementById('approvedSupplyDropdown');
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        renderApprovedSupplyDropdown();
        dropdown.style.display = "block";
      }
    }

    function renderApprovedSupplyDropdown() {
      const dropdown = document.getElementById('approvedSupplyDropdown');
      let html = '<div style="margin-bottom: 5px; font-weight: bold;">My AML Group</div>';
      const group1 = [
        { key: "amlDatabase", name: "MRC Global AML Database" },
        { key: "myAML", name: "My AML" },
        { key: "myAMLManufacturers", name: "MyAML-Manufacturers" },
        { key: "myAMLMaterials", name: "MyAML-Materials" },
        { key: "myAMLManageApprovals", name: "MyAML-Manage Approvals" },
        { key: "myAMLCustomAML", name: "MyAML-Custom AML" },
        { key: "approvedSupply", name: "Approved Supply" }
      ];
      group1.forEach(link => {
        html += `<div style="margin-bottom: 5px;">
                    <a href="javascript:void(0)" onclick="selectApprovedSupplySection('${link.key}')" style="color: #fff; text-decoration: none;">
                      ${link.name}
                    </a>
                  </div>`;
      });
      html += '<hr style="border-color: #444;">';
      html += '<div style="margin-bottom: 5px; font-weight: bold;">My AVL Group</div>';
      const group2 = [
        { key: "amlDatabase", name: "MRC Global AML Database" },
        { key: "myAML", name: "My AML" },
        { key: "myAVLManufacturers", name: "MyAVL-Manufacturers" },
        { key: "myAVLMaterials", name: "MyAVL-Materials" },
        { key: "myAVLManageApprovals", name: "MyAVL-Manage Approvals" },
        { key: "myAVLCustomAML", name: "MyAVL-Custom AML" }
      ];
      group2.forEach(link => {
        html += `<div style="margin-bottom: 5px;">
                    <a href="javascript:void(0)" onclick="selectApprovedSupplySection('${link.key}')" style="color: #fff; text-decoration: none;">
                      ${link.name}
                    </a>
                  </div>`;
      });
      dropdown.innerHTML = html;
    }

    function selectApprovedSupplySection(sectionKey) {
      showSection(sectionKey);
      document.getElementById('approvedSupplyDropdown').style.display = "none";
    }

    document.addEventListener('click', function(event) {
      const favDropdown = document.getElementById('favoritesDropdown');
      const favBtn = document.getElementById('favoritesBtn');
      if (!favDropdown.contains(event.target) && !favBtn.contains(event.target)) {
        favDropdown.style.display = "none";
      }
      const docDropdown = document.getElementById('documentsDropdown');
      const docBtn = document.getElementById('documentsBtn');
      if (docDropdown && docBtn && !docDropdown.contains(event.target) && !docBtn.contains(event.target)) {
        docDropdown.style.display = "none";
      }
      const auditDropdown = document.getElementById('auditDropdown');
      const auditBtn = document.getElementById('auditBtn');
      if (auditDropdown && auditBtn && !auditDropdown.contains(event.target) && !auditBtn.contains(event.target)) {
        auditDropdown.style.display = "none";
      }
      const rmDropdown = document.getElementById('resourceManagementDropdown');
      const rmBtn = document.getElementById('resourceManagementBtn');
      if (rmDropdown && rmBtn && !rmDropdown.contains(event.target) && !rmBtn.contains(event.target)) {
        rmDropdown.style.display = "none";
      }
      const asDropdown = document.getElementById('approvedSupplyDropdown');
      const asBtn = document.getElementById('approvedSupplyBtn');
      if (asDropdown && asBtn && !asDropdown.contains(event.target) && !asBtn.contains(event.target)) {
        asDropdown.style.display = "none";
      }
    });
    function renderAMLSubsections() {
      var subsections = sections['amlDatabase'].subsections;
      var tabs = document.getElementById('subsectionTabs');
      if (subsections && subsections.length > 0) {
        let html = '';
        subsections.forEach(function(subsection) {
          html += '<button onclick="selectAMLSubsection(\'' + subsection + '\')" style="padding: 5px 10px; margin-right: 5px; background: rgba(255,255,255,0.1); border: none; color: #fff; border-radius: 4px;">' + subsection + '</button>';
        });
        tabs.innerHTML = html;
        tabs.style.display = "flex";
      } else {
        tabs.style.display = "none";
      }
    }
    function selectAMLSubsection(subsection) {
      currentAMLSubsection = subsection;
      renderRecordsTable();
    }
    
    // NEW: User Profile Page Functions
    function showUserProfile() {
      // Hide all other views
      document.getElementById('homeView').style.display = "none";
      document.getElementById('dashboardView').style.display = "none";
      document.getElementById('sectionView').style.display = "none";
      document.getElementById('adminView').style.display = "none";
      // Show profile view
      document.getElementById('profileView').style.display = "";
      // Populate user profile details (using currentUser object)
      document.getElementById('profileUsername').textContent = currentUser.username || "User";
      document.getElementById('profileAvatar').src = "https://images.websim.ai/avatar/" + (currentUser.username || "default");
    }
    
    function goBack() {
      renderDashboard();
    }
    
    // Attach event listener to the User Profile button
    document.getElementById('userBtn').addEventListener('click', showUserProfile);
  </script>
</body>
</html>